<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>管理文件夹</title>
    <link rel="stylesheet" href="../css/public.css">
    <link rel="stylesheet" href="../css/bootstrap.css">
    
    <link rel="stylesheet" href="../css/index.css">
    <link rel="stylesheet" type="text/css" href="http://www.jq22.com/jquery/font-awesome.4.6.0.css">
    <link rel="stylesheet" type="text/css" href="../css/buind.css">
    <script src="../js/jquery-1.10.2.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <link href="../css/bootstrap-datetimepicker.min.css" rel="stylesheet" />
    <script src="../js/moment-with-locales.js"></script>
    <script src="../js/bootstrap-datetimepicker.min.js"></script>
    <script src="../js/bootstrap-datetimepicker.zh-CN.js"></script>

</head>
<body class="bgf3">
        <div class="brand h135">
            <ul class="breadcrumb f14">
                <li><a href="#" class="color color_8d">资源库</a>&nbsp;/&nbsp;</li>
                <li><a href="#"  class="color color_5a">管理文件夹</a></li>
            </ul>
            <h1>管理文件夹</h1>
    </div>
<div style="margin: 50px 70px 0 72px;background-color: #fff;">
    <p class="size" style="padding: 29px 0 0 20px;">任务列表</p>
    <div class="addInput" style="display: none">+添加</div>
    <table class="table" style="width: 100%;overflow: hidden;">
        <thead>
        <tr style="border-bottom: 1px solid #d8d8d8;background:rgba(243,243,243,1);font-size: 18px;height: 80px">
            <td>
                文件夹名称
            </td>
            <td>父级文件夹</td>
            <td style="font-weight: 600;">操作</td>
        </tr>
        </thead>
        <tbody class="bannerList">
        </tbody>
    </table>
</div>
<div class="nv91-mask" >
    <div class="nv91">
        <p style="font-size:20px;line-height:50px;border-bottom: 1px solid #dddddd;padding-left: 20px;">添加文件夹</p>
        <form action="" class="form-horizontal" role="form" style="text-align:center;">
            <div style="height: 120px">
                <div class="form-group  flex" style="padding-top: 30px; ">
                    <label for="name" class="control-label col-sm-3  rolename" style="text-align: right;line-height: 33.5px;padding-right: 5px">文件夹名称:</label>
                    <div class="col-sm-9">
                        <input type="text" class="form-control filename" placeholder="" style="width: 320px" />
                    </div>
                </div>
                <div class="form-group flex" style="padding-top: 20px">
                    <label for="name" class="control-label col-sm-3" style="text-align: right;line-height: 33.5px;padding-right: 5px">上级文件夹:</label>
                    <div class="col-sm-9">
                        <select name="" id="" class="form-control fileid" style="width: 320px">
                            <option value="0" selected>请选择</option>
                            <option value="1">新建文件夹一</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="form-group flex butto" style="border-top:1px solid #EBEBEB;margin-top: 100px;justify-content: flex-end;box-sizing: border-box;">
                <div class="col-sm-2" style="margin-top: 1%;margin-right:-4%;">
                    <button class="btn btn-primary fileSure" style="width: 60px;height: 40px">确定</button>
                </div>
                <div class="col-sm-2" style="margin-top: 1%;margin-right:8%;">
                    <button class="btn  fileRefuse" style="width: 60px;height: 40px">取消</button>
                </div>
            </div>
        </form>
    </div>
   <!--确认 取消-->
   <div class="confirm">
    <div  class="boxTotal">
        <img src="../image/hint.png" class="boxImg"/>
        <span class="boxDelete">确定要删除这条消息吗?</span>
        </div>
        <div class="dele">
        <button class="roleRefu  roleRefuse5">取消</button>
        <button class="roleSur roleSure">确定</button>
    </div>
</div>
<div class="confirm1">
    <div  class="boxTotal">
        <img src="../image/hint.png" class="boxImg"/>
        <span class="boxDelete prompt">确定要删除这条消息吗?</span>
        </div>
       
</div>
<div class="nv1">
    <img src="../image/success.png" class="success1"/>
    <span class="referMes prompt">删除成功</span>
</div>
<div class="nv3">
    <img src="../image/close12.png" class="success1"/>
    <span class="referMes prompt">删除失败</span>
</div>
</div>
<footer class="footer">
    东信在线门户运营后台
</footer>
</body>
</html>
<script src="../js/MD5.js"></script>
<script src="../js/sign.js"></script>
<script src="../js/api.js"></script>
<script src="../js/login.js"></script>
<script src="../js/getRequest.js"></script>
<script src="../js/judgeStatus.js"></script>
<script src="../js/resource.js"></script>
<script type="text/javascript">
    function changeState(el) {
        if (el.readOnly) el.checked=el.readOnly=false;
        else if (!el.checked) el.readOnly=el.indeterminate=true;
    }
  
        $(document).ready(function(){
            function judgeStatus(){
              //页面初次渲染加载数据
    var data = window.localStorage.getItem("dxRightsList");    
    data = JSON.parse(data);  
 //页面初次加载渲染页面
 var url,par;      
    var appsercet = window.localStorage.getItem("appsercet");
    appsercet = JSON.parse(appsercet);
    var newAppsercet = appsercet.data;
            //判断是否有添加管理员操作权限
        var arr = [];
        $.each(data,function(i,item){
            //console.log(item)
            if(item.id == 7){
                arr.push(item)
            }
        })
        var help ;
        
        console.log(arr[0]);
        $.each(arr[0].dxRightsList,function(i,item){
            //console.log(arr[0].dxRightsList)
            if(item.method === "get.dxWeb.libraryList"){
                url = src+"/"+item.link_path;
                help = "/"+item.link_path;
               
               
                //判断该角色是否有权限操作
                if(item.dxRightsTwoList.length == 0){
                    return
                }
                else{
                    $.each(item.dxRightsTwoList,function(i,obj){
                       //判断该用户是否有添加权限
                        if (obj.method === "get.dxWeb.addFolder") {
                            $(".addInput").show();
                            //添加按钮点击事件
                            $(".addInput").unbind('click').bind("click", function () {
                                // $(".addInput").click(function(){
                                $(".nv91-mask").show();
                                $(".nv91").show();
                                $(".fileSure").unbind('click').bind("click", function () {

                                    // $(".fileSure").click(function(){
                                    var data = addUpdate("get.dxWeb.addFolder");
                                    if (data.msg.code == "200") {
                                        $(".prompt").text("添加成功");
                                        $(".nv91-mask").show();
                                        $(".nv1").show();

                                        setTimeout(function () {
                                            $(".nv91-mask").hide();
                                            $(".nv1").hide();
                                            render();
                                            judgeStatus(7, "get.dxWeb.libraryList");
                                        }, 2000);

                                    } else {
                                        $(".prompt").text("添加失败");
                                        $(".nv91-mask").show();
                                        $(".nv1").show();
                                        setTimeout(function () {
                                            $(".nv91-mask").hide();
                                            $(".nv1").hide();

                                        }, 2000);
                                    }
                                })
                            })


                        }
                        //判断该用户是否有删除权限 
                       if (obj.method === "get.dxWeb.daleteFolder") {
                            //查看文章详情
                            $(".isDelete").show();
                            $(".isDelete").unbind('click').bind("click", function () {

                                // $(".isDelete").click(function(){
                                id = $(this).attr("data-id");
                                par = "appsercet=" + newAppsercet + "&method=get.dxWeb.daleteFolder&id=" + id;
                                var status = getSign(url, par);
                                if (status.msg.code == "200") {
                                    $(".prompt").text("删除成功");
                                    $(".nv91-mask").show();
                                    $(".nv1").show();

                                    setTimeout(function () {
                                        $(".nv91-mask").hide();
                                        $(".nv1").hide();
                                        render();

                                        judgeStatus();
                                    }, 2000);

                                } else {
                                    $(".prompt").text("删除失败");
                                    $(".nv91-mask").show();
                                    $(".nv1").show();
                                    setTimeout(function () {
                                        $(".nv91-mask").hide();
                                        $(".nv1").hide();

                                    }, 2000);
                                }

                            })



                        }  
                            //判断是否有编辑权限
                        if (obj.method === "get.dxWeb.updateFolder") {

                            $(".isEdit").show();
                            $(".isEdit").unbind('click').bind("click", function () {

                                // $(".isEdit").click(function(){
                                id = $(this).attr("data-id");
                                $(".nv91-mask").show();
                                $(".nv91").show();
                                par = "appsercet=" + newAppsercet + "&method=get.dxWeb.getFolder&id=" + id;
                                var data = getSign(url, par);

                                console.log(data)
                                $(".filename").val(data.msg.brand_name);
                                var li = document.querySelectorAll(".fileid option");
                                for (var i = 0; i < li.length; i++) {
                                    var obj = li[i]
                                    if (data.msg.father_brand_name == "" || data.msg.father_brand_name == null || data.msg.father_brand_name == "--") {
                                        li[0].checked = true;
                                    } else if (obj.value == data.msg.father_brand_name) {
                                        obj.checked = true;
                                    }
                                }
                                $(".fileSure").unbind('click').bind("click", function () {

                                    // $(".fileSure").click(function(){
                                    var data = addUpdate("get.dxWeb.updateFolder", id);
                                    if (data.msg.code == "200") {
                                        $(".prompt").text("修改成功");
                                        $(".nv91-mask").show();
                                        $(".nv1").show();

                                        setTimeout(function () {
                                            $(".nv91-mask").hide();
                                            $(".nv1").hide();
                                            render();
                                            judgeStatus();
                                        }, 2000);

                                    } else {
                                        $(".prompt").text("修改失败");
                                        $(".nv91-mask").show();
                                        $(".nv1").show();
                                        setTimeout(function () {
                                            $(".nv91-mask").hide();
                                            $(".nv1").hide();

                                        }, 2000);
                                    }
                                })
                            })
                          
                        }


                    })

                }
            }
           

        })
        }
    
        //封装添加修改方法
        function addUpdate(method,id){
            
            var appsercet = window.localStorage.getItem("appsercet");
            appsercet = JSON.parse(appsercet);
            var newAppsercet = appsercet.data;
            var sourceId,brandName,url,result
            url = src+"/libraryInterface.dx";
            brandName = $(".filename").val();
            sourceId = $(".fileid option:checked").val();

            if(method === "get.dxWeb.updateFolder"){

                par = "appsercet="+newAppsercet+"&method="+method+"&id="+id+"&brandName="+brandName+"&sourceId="+sourceId;
            }else if(sourceId == 0){

                par = "appsercet="+newAppsercet+"&method="+method+"&brandName="+brandName;
            }else{
                par = "appsercet="+newAppsercet+"&method="+method+"&brandName="+brandName+"&sourceId="+sourceId;
            }
            result = getSign(url,par);
            return result;
        }
        //初次加载页面获取列表数据
        var url,par,id;
        var appsercet = window.localStorage.getItem("appsercet");
        appsercet = JSON.parse(appsercet);
        var newAppsercet = appsercet.data;
        url = src+"/libraryInterface.dx";
        //初次渲染页面方法封装
        function render(){
            par = "appsercet="+newAppsercet+"&method=get.dxWeb.libraryList";
            var list = getSign(url,par);
            console.log(list);
            if(list.dxFolderList.length>0){
                $(".bannerList").html("");
                $(".fileid").html("");
                var str = "";
                var str1 = "";
                
                str1+="<option value='0' selected>请选择</option>"
                $.each(list.dxFolderList,function(i,item){
                    str1+="<option value='"+item.id+"' >"+item.brand_name+"</option>"
                    str+="<tr style='border-bottom: 1px solid #d8d8d8;color:#8D8D8D;'><td>"+item.brand_name+"</td><td>"+item.father_brand_name+"</td><td style='color:#48a4ea;'><span class='isDelete' data-id='"+item.id+"'>删除</span>&nbsp;<span class='isEdit' data-id='"+item.id+"'>编辑</span>&nbsp;</td></tr>"
                })
                $(".bannerList").html(str);
                $(".fileid").html(str1);
            }
        }
        render();
        //判断是否有添加删除编辑查看属性 
        judgeStatus();


    })

</script>
<script src="../js/radioAllChoose.js"></script>


