<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Banner管理</title>
    <link rel="stylesheet" href="../css/public.css">
    <link rel="stylesheet" href="../css/bootstrap.css">
    <link rel="stylesheet" href="../css/setting.css">
    <link rel="stylesheet" href="../css/index.css">

    <link rel="stylesheet" type="text/css" href="http://www.jq22.com/jquery/font-awesome.4.6.0.css">

    <link rel="stylesheet" type="text/css" href="http://www.jq22.com/jquery/font-awesome.4.6.0.css">
    <link rel="stylesheet" type="text/css" href="../css/buind.css">
    <link rel="stylesheet" href="../css/simple.switch.three.css">
    <script src="../js/jquery-1.10.2.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <!-- <script src="../js/183.js"></script> -->
    <script src="../js/simple.switch.min.js"></script>
    <link rel="stylesheet" href="../css/newPage.css">

    <script type="text/javascript" src="../js/jquery.min.js"></script>
    <script type="text/javascript" src="js/laydate.js"></script>

    <script type="text/javascript">
        // $('.laydate-icon').blur(function(){
        // 	var ret = contrastTime("date");//获取返回值
        // 	if(ret == 0){
        // 		alert("请选择正确的时间。");
        // 		$(this).val('');
        // 		return;
        // 	}else{

        //     }
        // })
        // $('#datePicker11').date_input();
        // $('#datePicker22').date_input();
        // $('#datePicker111').date_input();
        // $('#datePicker222').date_input();
    </script>


    <style>
        .date_selector{top:50px!important;left: 0!important;}
        .date_picker{width: auto!important;}
        .pr2{padding:0 20px;}
        .pb2{justify-content: space-between;}
        .switch {
            width: 57px;
            height: 28px;
            position: relative;
            border: 1px solid #dfdfdf;
            background-color: #fdfdfd;
            box-shadow: #dfdfdf 0 0 0 0 inset;
            border-radius: 20px;
            background-clip: content-box;
            display: inline-block;
            -webkit-appearance: none;
            user-select: none;
            outline: none;
        }
        .switch:before {
            content: '';
            width: 26px;
            height: 26px;
            position: absolute;
            top: 0;
            left: 0;
            border-radius: 20px;
            background-color: #fff;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
        }
        .switch:checked {
            border-color: #8A111A;
            box-shadow: #8A111A 0 0 0 16px inset;
            background-color: #8A111A;
        }
        .switch:checked:before {
            left: 30px;
        }
        .switch.switch-anim {
            transition: border cubic-bezier(0, 0, 0, 1) 0.4s, box-shadow cubic-bezier(0, 0, 0, 1) 0.4s;
        }
        .switch.switch-anim:before {
            transition: left 0.3s;
        }
        .switch.switch-anim:checked {
            box-shadow: #8A111A 0 0 0 16px inset;
            background-color: #8A111A;
            transition: border ease 0.4s, box-shadow ease 0.4s, background-color ease 1.2s;
        }
        .switch.switch-anim:checked:before {
            transition: left 0.3s;
        }
        .disnone{display: none}
        .textLeft{text-align: left;}
        /* .toDown{display: none;} */
        .table td:first-child {
            text-align: left;
            padding-left: 30px;
            width: 13%;
        }
        .laydate-icon{height: auto;}
        .confirm1{z-index: 9999;}
    </style>
</head>
<body style="background: #f3f3f3;">
<div class="row">

</div>
<div class="brand" style="background: #fff;">
    <ul class="breadcrumb fff14">
        <li><a href="#" class="color_8d" class="color">网站运营</a>&nbsp;/&nbsp;</li>
        <li><a href="#" class="color_5a" class="color">Banner管理</a></li>
    </ul>
    <h1>Banner管理</h1>
</div>
<div class="nv91-mask" >
    <!--确认 取消-->
    <div class="confirm">
        <div  class="boxTotal">
            <img src="../image/hint.png" class="boxImg"/>
            <span class="boxDelete">确定要删除这条消息吗?</span>
            </div>
            <div class="dele">
            <button class="roleRefu  roleRefuse5">取消</button>
            <button class="roleSur roleSure">确定</button>
        </div>
    </div>
    <div class="nv1">
        <img src="../image/success.png" class="success1"/>
        <span class="referMes prompt">删除成功</span>
    </div>
    
    <form class="nv91 p5_0" >
        <div   class="form-horizontal textCenter" id="form">
            <div class="nv91-close">✕</div>
            <div class="form-group  flex needHide">
                <label for="name" class="control-label col-sm-3 star rolename lh15" style="padding-right: 5px" >Banner图片:</label>
                <div class="col-sm-9">
                    <input type="text" class="form-control upload1" placeholder="请选择上传图片" style="width: 70%"/>
                    <input type="file" class="hideFile" id='fileUpload' name="picimg" style="width: 70%"/>

                </div>
            </div>
            <div class="form-group  flex slideImg"  >
                <label for="name" class="control-label col-sm-3  lh15" style="padding-right: 5px" >Banner图片:</label>
                <img src="" alt=""  class='updateimg'>
            </div>
            <div class="form-group  flex">
                <label for="name" class="control-label col-sm-3  lh15" style="padding-right: 5px" >Banner图片名称:</label>
                <div class="col-sm-9">
                    <input type="text" class="form-control bannerName" placeholder=" 请填写上传图片名称" style="width: 70%"/>
                </div>
            </div>
            <div class="form-group  flex">
                <label for="name" class="control-label col-sm-3 lh15 "style="padding-right: 5px" >URL地址:</label>
                <div class="col-sm-9">
                    <input type="text" class="form-control url" placeholder="请输入公司链接地址"style="width: 70%"  />
                </div>
            </div>
            <div class="form-group  flex">
                <label for="name" class="control-label col-sm-3  lh15"style="padding-right: 5px" >Banner位置:</label>
                <div class="col-sm-9">
                    <select  id="" class="form-control  cateId" style="width: 70%">
                        <option value="0" selected>--请选择--</option>
                    </select>
                </div>
            </div>
            <div class="form-group  flex">
                <label for="name" class="control-label col-sm-3  lh15" style="padding-right: 5px">开始时间:</label>

                <div class="col-sm-6 ">
                        <input class="inline laydate-icon form-control start" id="start1" placeholder="开始时间" />
                </div>
            </div>
            <div class="form-group  flex">
                <label for="name" class="control-label col-sm-3  lh15" style="padding-right: 5px">结束时间:</label>
                <div class="col-sm-6">
                        <input class="inline laydate-icon form-control end" id="end1" placeholder="结束时间"/>
                </div>
            </div>
            <div class="form-group flex" style="line-height:30px">
                <label for="name" class="control-label col-sm-3 lh15" style="padding-top: 6px" >是否上线:</label>
                <div class="radio radio-info radio-inline ">
                    <input type="radio" id="b6" value="1" name="state" checked="" class="b6">
                    <label for="b6"> 是 </label>
                </div>
                <div class="radio radio-info radio-inline">
                    <input type="radio" id="b7" value="2" name="state" checked="" class="b6">
                    <label for="b7"> 否 </label>
                </div>
            </div>

            <div class="form-group flex butto" >
                <div class="col-sm-2" >
                    <button class="btn btn-primary BannerSure banner aveBtn" style="margin-top: 7px;width: 60px;height: 40px;">确定</button>
                </div>
                <div class="col-sm-2 mar12" >
                    <button class="btn  BannerRefuse banner" style="width: 60px;height: 40px;">取消</button>
                </div>
            </div>

        </div>
    </form>
    <div class="confirm1" >
            <div  class="boxTotal">
                <img src="../image/hint.png" class="boxImg"/>
                <span class="boxDelete prompt">确定要删除这条消息吗?</span>
                </div>

        </div>
</div>

<div class="col-sm-10 col-sm-pull-1" style="padding-top: 40px;width: 90%;margin: 0 auto;background: #fff;margin-top: 30px;">
    <div class="flex w100 pb2" style="max-height: 60px">
        <div class="col-sm-12 col-md-6 col-lg-4 flex">

            <span class="pr2" >筛选查询</span>
            <label for="name" class="control-label lh15 mr5" style="line-height:33.5px;font-size: 18px">位置:</label>
            <div style="width: 40%">
                <select class="form-control location" style="width: 100%;">
                    <option checked>--请选择--</option>

                </select>
            </div>

        </div>

        <div class="flex textRight textLeft col-sm-12 col-md-6 col-lg-4">

            <div class="col-sm-3" style="max-width: 80px;">
                <label for="name" class="control-label lh15 mr5" style="margin-left: -5px;line-height:37px;font-size: 18px">到期时间:</label>
            </div>
            <div class="position col-sm-9 flex" >
                <div class="col-sm-5" style="width: 100px;">
                    <input class="inline laydate-icon form-control" id="start" placeholder="开始时间"/>
                </div>
                <p style="line-height:37px">&nbsp;&nbsp;—&nbsp;&nbsp;</p>
                <div class="col-sm-5" >
                        <input class="inline laydate-icon form-control" id="end" placeholder="结束时间" />
                </div>

                <!--<input type="text" class=" form-control start1" style="width: 70%;margin-left: 72px;margin-top: -34px;" />-->


                <!--<input type="text" class="form-control end1"/>-->

                <!--<button class="btn sec1">查询</button>-->
                <!--<span style="font-family: iconfont;position: absolute;right: 5%;top:0;font-size: 24px;" >&#xe73a;</span>-->
            </div>
        </div>
        <div class="flex textRight col-sm-12 col-md-6 col-lg-4 position">
            <input type="text" class="form-control bannerName12" placeholder="请输入banner名称" style="height: 36px;max-width: 80%"/>
            <span style="font-family: iconfont;position: absolute;right: 21%;top:0;font-size: 24px;" class="banner1">&#xe615;</span>
        </div>
    </div>
    <hr style="width: 120%;background-color: #f3f3f3;height: 50px;margin-right: -15px;border: none"/>
    <div class="b_list" style="padding-left: 31px;">
        <p class="pr2">任务列表</p>
    </div>
    <div class="addInput">+添加</div>
    <table class="table w100" >
        <thead>

        <tr class="bb">
            <td class="position">
                Banner图片
            </td>
            <td>Banner名称</td>
            <td>Banner位置</td>
            <td>置顶</td>
            <td>时间</td>
            <td>上线/下线</td>
            <td>点击次数</td>
            <td class="weight600">操作</td>
        </tr>
        </thead>
        <tbody class="bannerList">


        </tbody>
    </table>
    <div class="paging flex " style="width:100%;justify-content: flex-end;" >
        <div id="pagination2" class="pagination"></div>

    </div>

</div>
<footer class="footer">
    <p>Copyright 2017 中国东信云通信平台 All Right Reserved 中国—东盟信息港股份有限公司北京分公司
    </p>
    <p>增值电信业务经营许可证：B2-20180289 涉密信息系统集成许可证：JC301700083</p>

    <p>桂ICP备16005301号-7 桂公网安备45010802000099号</p>
</footer>
</body>
</html>
<script>
    // var length = $(".checkbox").length;
    // for(var i = 0;i < length;i++){
    //     $(".checkbox").eq(i).simpleSwitch({
    //         "theme": "FlatCircular"
    //     });
    // }

</script>
<script src="../js/jquery-1.10.2.min.js"></script>
<script src="../js/MD5.js"></script>
<script src="../js/sign.js"></script>
<script src="../js/api.js"></script>
<script src="../js/postSign.js"></script>
<script src="../js/getRequest.js"></script>
<script src="../js/bannermanager.js"></script>
<script src="../js/newPage.js"></script>


<script src="../js/addtext.js"></script>
<script>
//通过反馈时间查询
!function () {
            laydate.skin('molv');//切换皮肤，请查看skins下面皮肤库
            laydate({ elem: '#demo' });//绑定元素
        }();

        //日期范围限制
        var start = {
            elem: '#start',
            format: 'YYYY-MM-DD',
            min: laydate.now(), //设定最小日期为当前日期
            max: '2099-06-16', //最大日期
            istime: true,
            istoday: false,
            choose: function (datas) {
                end.min = datas; //开始日选好后，重置结束日的最小日期
                end.start = datas //将结束日的初始值设定为开始日
            }
        };
        var endTime = "";
        var end = {
            elem: '#end',
            format: 'YYYY-MM-DD',
            min: laydate.now(),
            max: '2099-06-16',
            istime: true,
            istoday: false,
            choose: function (values, datas) {
                start.max = datas; //结束日选好后，充值开始日的最大日期
                console.log(values);
                endTime = values;
                var starttime = $("#start").val();
                var url = src + "/bannerGetInterface.dx";
                var appsercet = window.localStorage.getItem("appsercet");
                appsercet = JSON.parse(appsercet);
                newAppsercet = appsercet.data;
                par = "appsercet=" + newAppsercet + "&method=get.dxWeb.bannerList&starttime=" + starttime + "&erdtime=" + endTime;

                var bannerList = getSign(url, par);
                if (bannerList.msg && bannerList.msg.code == "10") {
                    $(".bannerList").html("");

                } else {
                    bannerList1(bannerList);
                    firstRender();
                }


            }
        };
        laydate(start);
        laydate(end);
        var start1 = {
    elem: '#start1',
    format: 'YYYY-MM-DD',
    min: laydate.now(), //设定最小日期为当前日期
    max: '2099-06-16', //最大日期
    istime: true,
    istoday: false,
    choose: function(datas){
         end.min = datas; //开始日选好后，重置结束日的最小日期
         end.start = datas //将结束日的初始值设定为开始日
    }
};

var end1 = {
    elem: '#end1',
    format: 'YYYY-MM-DD',
    min: laydate.now(),
    max: '2099-06-16',
    istime: true,
    istoday: false,
    choose: function(values,datas){
        start.max = datas; //结束日选好后，充值开始日的最大日期
        console.log(values);

        console.log("----------");
        console.log(datas);
    }
};
laydate(start1);
        laydate(end1);
 //页面渲染函数封装
 function bannerList1(bannerList){
            if(bannerList.dxBannerList){
                $(".bannerList").html("");
            var banner = "";
            if (bannerList.dxBannerList.length > 0) {
                $.each(bannerList.dxBannerList, function (i, item) {
                    banner += "<tr style='border-bottom: 1px solid #d8d8d8;color: #8D8D8D;' class='' data-id='" + item.id + "'>";
                    banner += "<td><a href='' class='hrefUrl'><img src='" + item.pic_img + "' style='width: 50px;height:50px;' /></a></td><td>" + item.pic_title + "</td><td>"+item.cate_name+"</td>"
                    if (item.is_up == 1) {
                        banner += "<td>&#10003;</td>";
                    } else {
                        banner += "<td>&#10007;</td>"
                    }
                    banner+="<td><span style='display:block'>" + item.begin_time + "</span><span style='display:block'>" + item.end_time + "</span>";
                    if(item.state == 1){
                        banner+="<td><input class='switch switch-anim' type='checkbox' checked data-id='" + item.id + "'></td>";
                    }else{
                        banner+="<td><input class='switch switch-anim' type='checkbox' data-id='" + item.id + "'></td>";
                    }

                    banner+="<td>" + item.frequency + "</td><td style='color: #FF5456; ' ><span class='isEdit' data-id='" + item.id + "' >编辑</span>&nbsp;<span class='isDelete' data-id='" + item.id + "'>删除</span>&nbsp;"
                    if (item.is_up == 1) {
                        banner+="<span class='toDown' data-id='" + item.id + "'>取消置顶</span></td>";
                    } else {
                        banner+="<span class='toTop ' data-id='" + item.id + "'>置顶</span>&nbsp;<span class='toDown disnone' data-id='" + item.id + "'>取消置顶</span></td>";
                    }

                    banner += "</tr>";

                })
               $(".bannerList").html(banner);
               firstRender();
               var switch1 = document.querySelectorAll(".switch");

               var state,id;
               $(".switch").unbind('click').bind("click",function(){
                var index = $(this).index();
                //1. 获取id值
                var id = $(this).attr("data-id");
                if($(this).prop("checked")){
                    state = 1;

                }else{
                    state = 2;

                }
                par = "appsercet="+newAppsercet+"&method=get.dxWeb.updatehelp&id="+id+"&state="+state;
                var data = getSign(url,par);
                if(data.msg.code == "200"){
                    $(".confirm").hide();
                    $(".prompt").text("操作成功");
                    $(".nv91-mask").show();
                    $(".nv1").show();
                    $(".nv3").hide();
                    setTimeout(function () {
                        $(".nv91-mask").hide();
                        $(".nv1").hide();

                    }, 2000);

                    par = "appsercet=" + newAppsercet + "&method=get.dxWeb.bannerList";
                    var data = getSign(url, par);
                    bannerList1(data);
                }

                 });


            }
    }
        }
        function firstRender() {
            //页面初次渲染加载数据
            var data = window.localStorage.getItem("dxRightsList");
            data = JSON.parse(data);
            if (data.length > 0) {
                var arr = [];
                $.each(data, function (i, item) {
                    //console.log(item)
                    if (item.id == 2) {
                        arr.push(item)
                    }
                })
                $.each(arr[0].dxRightsList, function (i, item) {
                    if (item.method === "get.dxWeb.bannerList") {

                        if (item.dxRightsTwoList.length == 0) {
                            return
                        }
                        else {
                            $.each(item.dxRightsTwoList, function (i, obj) {
                                //判断该用户是否有添加管理员权限                     debugger
                                if (obj.method === "get.dxWeb.addhelp") {
                                    $(".add").show();
                                    //Banner添加事件
                                    $(".addInput").click(function () {

                                        $(".nv91-mask").show();
                                        $(".nv91").show();
                                        $(".upload1").click(function (event) {
                                            event.stopPropagation();
                                            $("#fileUpload").show().css({"height":"50px","border":"none"});
                                            $(this).hide();

                                        })
                                        $("#fileUpload").change(function () {
                                            $(".needHide").hide();
                                            $(".slideImg").slideDown();
                                            fileDom = document.getElementById("fileUpload");
                                        imgPreview(fileDom);
                                        })
                                        $(".updateimg").click(function () {
                                            debugger
                                            $(".needHide").show();
                                            $(".slideImg").hide();

                                        })
                                        $(".BannerSure").click(function () {


                                            var success = formValidater();
                                           if(success == true){
                                            getContentTwo("get.dxWeb.addhelp", 1);
                                           }else{
                                               return;
                                           }


                                        })
                                    })
                                }
                                //判断该用户是否有删除权限
                                if (obj.method === "get.dxWeb.deleteBanner") {
                                    $(".isDelete").show();
                                    //banner删除事件

                                    $(".isDelete").click(function () {
                                        $(".nv91-mask").show();
                                        $(".confirm").show();
                                        var IdList = $(this).attr("data-id");
                                        $(".roleSure").click(function(){

                                            par = "appsercet=" + newAppsercet + "&method=get.dxWeb.deleteBanner&id=" + IdList;

                                            var data = getSign(url, par);
                                            if (data.msg.code == "200") {
                                                $(".confirm").hide();
                                                $(".nv1").show();
                                                setTimeout(function(){
                                                    $(".nv91-mask").hide();
                                                    $(".nv1").hide();
                                                   location.reload();
                                                },2000);
                                            }else{
                                                $(".confirm").hide();
                                                $(".nv3").show();
                                                setTimeout(function(){
                                                    $(".nv91-mask").hide();
                                                    $(".nv3").hide();
                                                },2000);
                                            }
                                        })
                                        $(".roleRefuse5").click(function(){
                                            $(".nv91-mask").hide();
                                            $(".confirm").hide();
                                        })

                                    })

                                }
                                //判断是否有置顶权限
                                if (obj.method === "get.dxWeb.topBanner") {

                                    $(".toTop").show();
                                    //banner置顶事件
                                    $(".toTop").unbind('click').bind("click",function(){

                                        debugger
                                        var index = $(this).index();

                                        var id = $(this).attr("data-id");
                                        par = "appsercet=" + newAppsercet + "&method=get.dxWeb.topBanner&id=" + id+"&type=1";
                                        var statu = getSign(url, par);

                                        if (statu.msg.code == "200") {
                                            $(".confirm").hide();
                                            $(".prompt").text("操作成功");
                                            $(".nv91-mask").show();
                                            $(".nv1").show();
                                            $(".nv3").hide();
                                            setTimeout(function () {
                                                $(".nv91-mask").hide();
                                                $(".nv1").hide();
                                                location.reload();

                                            }, 2000);

                                        }
                                    })
                                    $(".toDown").unbind('click').bind("click",function(){

                                        var id = $(this).attr("data-id");
                                        par = "appsercet=" + newAppsercet + "&method=get.dxWeb.topBanner&id=" + id+"&type=2";
                                        var statu = getSign(url, par);
                                        if (statu.msg.code == "200") {
                                            $(".confirm").hide();
                                            $(".prompt").text("操作成功");
                                            $(".nv91-mask").show();
                                            $(".nv1").show();
                                            $(".nv3").hide();
                                            setTimeout(function () {
                                                $(".nv91-mask").hide();
                                                $(".nv1").hide();
                                                location.reload();

                                            }, 2000);

                                        }
                                    })
                                }
                                //判断是否有编辑权限

                                if (obj.method === "get.dxWeb.updatehelp") {

                                    $(".isEdit").show();
                                    //banner编辑修改事件
                                    $(".isEdit").click(function () {
                                        debugger
                                        var id = $(this).attr("data-id")
                                        // var index = $(this).index;
                                        $(".nv91-mask").show();
                                        $(".nv91").show();
                                        $(".slideImg").show();
                                        $(".needHide").hide();

                                        par = "appsercet=" + newAppsercet + "&method=get.dxWeb.getBanner&id=" + id;

                                        var details = getSign(url, par);
                                        console.log(details);
                                        // $("#fileUpload").val(details.msg.pic_img)
                                        $(".bannerName").val(details.msg.pic_title);
                                        var bannerCate = document.querySelectorAll(".cateId option");
                                        for (var i = 0; i < bannerCate.length; i++) {
                                            var item = bannerCate[i];
                                            if (item.value == details.msg.cate_id) {
                                                item.selected = true;
                                            }
                                        }
                                        debugger
                                           $(".updateimg").attr("src",details.msg.pic_img)
                                        $(".start").val(details.msg.begin_time);
                                        $(".end").val(details.msg.end_time);
                                        $(".url").val(details.msg.pic_url);
                                        var radio = document.querySelectorAll(".b6 ");
                                        for (var i = 0; i < radio.length; i++) {
                                            var obj = radio[i]
                                            if (obj.value == details.msg.state) {
                                                obj.checked = true;
                                            }
                                        }
                                        $(".updateimg").click(function () {
                                            debugger
                                            $(".needHide").show();
                                            $(".slideImg").hide();
                                            $(".upload1").unbind('click').bind("click",function(){

                                                $("#fileUpload").click();
                                                $("#fileUpload").change(function () {
                                                    $(".needHide").hide();
                                                    $(".slideImg").slideDown();
                                                    fileDom = document.getElementById("fileUpload");
                                                    imgPreview(fileDom);
                                                })
                                            })


                                        })
                                        $(".BannerSure").click(function () {
                                            var sign1 = sign("get.dxWeb.updatehelp");
                                            var sign2 = sign1.parameter;
                                            var timestamp = sign1.timestamp;


                                            var success = formValidater();
                                           if(success == true){
                                            getContentTwo("get.dxWeb.updatehelp", id);
                                           }else{
                                               return;
                                           }

                                        })
                                    })
                                }

                            })
                        }
                    }
                })
            }
        }


</script>



