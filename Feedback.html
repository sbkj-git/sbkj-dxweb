<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>操作日志</title>
    <link rel="stylesheet" href="./css/public.css">
    <link rel="stylesheet" href="./css/bootstrap.css">
    <link rel="stylesheet" href="./css/setting.css">
    <link rel="stylesheet" href="./css/index.css">
<link rel="stylesheet" type="text/css" href="http://www.jq22.com/jquery/font-awesome.4.6.0.css">
<link rel="stylesheet" type="text/css" href="./css/buind.css">
<script src="./js/jquery-1.10.2.min.js"></script>
<script src="./js/bootstrap.min.js"></script>
<link rel="stylesheet" href="./js/js/daterangepicker.css">
<script src="./js/js/moment.min.js"></script>
<script src="./js/js/daterangepicker.js"></script>
<script src="./js/js/package.js"></script>
<script src="./js/getRequest.js"></script>
<script src="./js/MD5.js"></script>

<style>
.lookType,.details{display: none;}
</style>
</head>
<body style="background-color:#fbfbfb;width: inherit;box-sizing: border-box;padding-left: 50px;">
    <div class="brand">
        <ul class="breadcrumb" style="background-color:#fff;font-size: 14px;">
            <li><a href="#" style="color:#8D8D8D;">设置</a>&nbsp;/&nbsp;</li>
            <li><a href="#" style="color:#5A5A5A;">操作日志</a></li>
        </ul>
        <h1>操作日志</h1>
    </div>
    <ul class="chooseCard flex">
        <li class="chooseActive">管理反馈内容</li>
        <li class="lookType">功能设置</li>
    </ul>
   <div class="col-sm-10 col-sm-pull-1" style="margin-top: 2%;">
        <div class="choose1">
            <div class="flex" style="width:100%;padding-bottom: 2%;">
                <div class="col-sm-3">
                    <button class="btn-primary btn export" style="margin-right: 1%;">导出反馈</button>
                    <button class="btn isDelete">删除反馈</button>
                </div>
                <div class="col-sm-6 flex " style="text-align: right;">
                    <label for="name" class="control-label" style="text-align: right;line-height: 1.5;margin-right: 5px;">反馈时间:</label>
                    <div class="position">
                        <input type="text" class="form-control" id="nowdate" />
                        <span style="font-family: iconfont;position: absolute;right: 1%;top:0;font-size: 24px;" id="datetimepicker1">&#xe73a;</span>
                    </div>
            
                </div>
                <div class="col-sm-3 flex " style="text-align: right;">
                    <div class="position">
                        <input type="text" class="form-control content" style="padding-top: 0px;" placeholder="请输入姓名、反馈内容" />
                        <span style="font-family: iconfont;position: absolute;right: 1%;top:0;font-size: 24px;" class="openContent">&#xe615;</span>
                    </div>
            
                </div>
            </div>
            <table class="table" style="width: 100%;overflow: hidden;">
                <thead>
                    <tr style="border-bottom: 1px solid #d8d8d8;">
                        <td class="position">
                            <div class="radio radio-info radio-inline">
                                <input type="radio" id="tall" name="tall" class="tall">
                                <label for="tall"> 类型 </label>
                            </div>
                        </td>
                        <td>反馈内容</td>
                        <td>IP</td>
                        <td>反馈时间</td>
                        <td style="font-weight: 600;">操作</td>
                    </tr>
                </thead>
                <tbody class="feedback">
                   
                </tbody>
            </table>
        </div>
        <div class="choose1 " style="display: none!important;">
          <div class="col-sm-12 flex" style="border-bottom:1px solid #dddddd;padding-bottom: 2%;;">
              <span>验证码:</span>
                <div class="radio radio-info radio-inline">
                        <input type="radio" id="f1" value="option1" name="radioInline" checked="" class="validate">
                        <label for="f1"> 必填 </label>
                </div>
                <div class="radio radio-info radio-inline">
                        <input type="radio" id="f2" value="option1" name="radioInline" checked="" class="validate">
                        <label for="f2"> 防刷保护 </label>
                        
                </div>
                <div>
                     <img src="./image/u706.png" alt="" data-hint="提示信息" style="width: 30px;height:30px;"  class="hint--bottom">
                </div>
               
          </div>
          <div class="addInput">+添加</div>
         <table class="table" style="width: 100%;overflow: hidden;">
            <thead>
                <tr >
                    <td>留言项名称</td>
                    <td>类型</td>
                    <td>显示</td>
                    <td>必填</td>
                    <td style="font-weight: 600;">操作</td>
                </tr>
            </thead>
            <tbody class="double">
                
            </tbody>
         </table>
        </div>
       <div class="flex" style="justify-content: center;">
           <button class="btn btn-primary" style="margin-right: 2%;">保存</button>
           <button class="btn">取消</button>

       </div>
   </div>
   <div class="nv91-mask">
        <div class="nv91">
            <h1 class="position">添加留言项<div class="nv91-close">&#10005;</div>
            </h1>
            <form action="" class="form-horizontal" role="form">
                <div class="form-group  flex">
                    <label for="name" class="control-label col-sm-2" style="text-align: right;line-height: 1.5;">新项名称：:</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control newProject" placeholder="请输入新项名称" />
                    </div>
                </div>
                <div class="form-group flex">
                    <label for="name" class="control-label col-sm-2" style="text-align: right;line-height: 1.5;">类型:</label>
                    <div class="radio radio-info radio-inline">
                        <input type="radio" id="f3" value="" name="state" class="state">
                        <label for="f3"> 文本框 </label>
                    </div>
                    <div class="radio radio-info radio-inline">
                        <input type="radio" id="f4" value="" name="state" class="state">
                        <label for="f4"> 复选框 </label>
                    </div>
                </div>
                <div class="form-group flex">
                    <label for="name" class="control-label col-sm-2" style="text-align: right;line-height: 1.5;">是否显示:</label>
                    <div class="radio radio-info radio-inline">
                        <input type="radio" id="f5" value="" name="state1" class="state1">
                        <label for="f5"> 是 </label>
                    </div>
                    <div class="radio radio-info radio-inline">
                        <input type="radio" id="f6" value="" name="state1" class="state1">
                        <label for="f6"> 否 </label>
                    </div>
                </div>
                <div class="form-group flex">
                    <label for="name" class="control-label col-sm-2" style="text-align: right;line-height: 1.5;">是否必填:</label>
                    <div class="radio radio-info radio-inline">
                        <input type="radio" id="f7" value="" name="state2" class="state2">
                        <label for="f7"> 是 </label>
                    </div>
                    <div class="radio radio-info radio-inline">
                        <input type="radio" id="f8" value="" name="state2" class="state2">
                        <label for="f8"> 否 </label>
                    </div>
                </div>
                <div class="form-group flex" style="border-top:1px solid #EBEBEB;margin-top: 100px;justify-content: flex-end;box-sizing: border-box;">
                    <div class="col-sm-1" style="margin-top: 1%;">
                        <button class="btn">取消</button>
                    </div>
                    <div class="col-sm-1" style="margin-top: 1%;margin-right:2%;">
                        <button class="btn btn-primary addProject">确定</button>
                    </div>
                </div>
            </form>
        </div>
        <div class="nv92">
            <h1 class="position">反馈详情<div class="nv92-close">&#10005;</div>
            </h1>
            <form action="" class="form-horizontal" role="form">
                <div class="form-group  flex">
                    <label for="name" class="control-label col-sm-2" style="text-align: right;line-height: 1.5;">姓名:</label>
                    <div class="col-sm-10">
                        <span class="re1">李大仁</span>
                    </div>
                </div>
                <div class="form-group  flex">
                    <label for="name" class="control-label col-sm-2" style="text-align: right;line-height: 1.5;">邮箱:</label>
                    <div class="col-sm-10">
                        <span class="re2">13111111111@163.com</span>
                    </div>
                </div>
                <div class="form-group  flex">
                    <label for="name" class="control-label col-sm-2" style="text-align: right;line-height: 1.5;">电话:</label>
                    <div class="col-sm-10">
                        <span class="re3">13111111111</span>
                    </div>
                </div>
                <div class="form-group  flex">
                    <label for="name" class="control-label col-sm-2" style="text-align: right;line-height: 1.5;">类型:</label>
                    <div class="col-sm-10">
                        <span class="re4">类型</span>
                    </div>
                </div>
                <div class="form-group  flex">
                    <label for="name" class="control-label col-sm-2" style="text-align: right;line-height: 1.5;">反馈内容:</label>
                    <div class="col-sm-10">
                        <span class="re5">反馈内容</span>
                    </div>
                </div>
                <div class="form-group flex" style="border-top:1px solid #EBEBEB;margin-top: 100px;justify-content: flex-end;box-sizing: border-box;">
                    <div class="col-sm-1" style="margin-top: 1%;">
                        <button class="btn">取消</button>
                    </div>
                    <div class="col-sm-1" style="margin-top: 1%;margin-right:2%;">
                        <button class="btn btn-primary nav2-sure">确定</button>
                    </div>
                </div>
            </form>
        </div>
   </div>
   <footer class="footer">
        <p>Copyright 2017 中国东信云通信平台 All Right Reserved 中国—东盟信息港股份有限公司北京分公司
         </p>
        <p>增值电信业务经营许可证：B2-20180289 涉密信息系统集成许可证：JC301700083</p>
         
         <p>桂ICP备16005301号-7 桂公网安备45010802000099号</p>
    </footer>
</body>
</html>
<script src="./js/MD5.js"></script>
<script src="./js/sign.js"></script>
<script src="./js/api.js"></script>
<script src="./js/getRequest.js"></script>
<script type="text/javascript">
    function changeState(el) {
        if (el.readOnly) el.checked=el.readOnly=false;
        else if (!el.checked) el.readOnly=el.indeterminate=true;
    }
    $(document).ready(function(){
                  
        //调取时间选择
        //选项卡切换
        $(".chooseCard li").click(function(){
            var index = $(this).index();
            $(".chooseCard li").removeClass("chooseActive").eq(index).addClass("chooseActive");
            $(".choose1").hide().eq(index).show();
        });
            //功能设置弹窗关闭按钮点击
            $(".nv91-close").click(function(){
                $(".nv91-mask").fadeOut();
                $(".nv91").hide();
            })
            //弹窗关闭按钮点击
            $(".nv92-close").click(function(){
                $(".nv91-mask").fadeOut();
                $(".nv92").hide();
            })
            //导出数据到本地
            $(".export").click(function(){     
                var IdList;
                var checkboxArray = [];//初始化空数组，用来存放checkbox对象。
                    for (var i = 0; i < inputs.length; i++) {
                    var obj = inputs[i];
                    if (obj.type == 'checkbox') {
                        checkboxArray.push(obj);
                    }
                }
               IdList = new Array();
                for (var i = 0; i < checkboxArray.length; i++) {
                    if (checkboxArray[i].checked)
                    IdList.push(checkboxArray[i].getAttribute("data-id"));
                }
                url = noapi + "/dxExportComplaint.dx";
                par = "IdList="+IdList;
                var data = getSign(url,par);
            })
    })
</script>
<script>
 //页面初次渲染加载数据
 var data = window.localStorage.getItem("dxRightsList");    
data = JSON.parse(data);      
//console.log(data);
 var url,par;      
    var appsercet = window.localStorage.getItem("appsercet");
    appsercet = JSON.parse(appsercet);
    var newAppsercet = appsercet.data;
    function render1(data2){
        if (data2.dxComplaintCateList.length > 0) {
            var str
            $.each(data2.dxComplaintCateList, function (i, obj) {
                str += "<tr style='border-bottom: 1px solid #d8d8d8;' data-id='" + obj.id + "'>";
                str += "<td><div class='checkbox checkbox-primary'><input type='checkbox' class='styled styled-primary t1' id='t" + i + "'  aria-label='Single checkbox Two'data-id='" + obj.id + "' ><label for='t" + i + "'>" + obj.complaint_name + "</label></div></td><td>" + obj.feedback_content + "</td><td>" + obj.ip_addr + "</td> <td>" + obj.create_time + "</td><td><a  style='color:#FF5456;'' class='details' data-id='" + obj.id + "'>详情</a></td>"
                str += "</tr> "
            })
            $(".feedback").append(str);
        }
    }
    //判断是否有添加管理员操作权限
    var arr = [];
    $.each(data, function (i, item) {
        //console.log(item)
        if (item.id == 8) {
            arr.push(item)
        }
    })
    console.log(arr[0]);
    $.each(arr[0].dxRightsList, function (i, item) {
        //console.log(arr[0].dxRightsList)
        if (item.method === "get.dxWeb.feedbackList") {
            url = src + "/" + item.link_path;
            par = "appsercet=" + newAppsercet + "&method=" + item.method;
            
            var data2 = getSign(url, par);
            console.log(data2)
            render1(data2);
            //通过用户名查找
            $(".openContent").click(function(){
                var content = $(".content").val();
                if(content == null || content == ""){
                    return
                }else{
                    par = "appsercet=" + newAppsercet + "&method=" + item.method+"&content="+content;
                    
                    var data2 = getSign(url, par);
                    render1(data2);
                }
            })
           //通过时间查找

           
           
				// starttime       否           开始时间
                // erdtime         否           结束时间
            //查看投诉和反馈验证码设置详情
            var url = src + "/adminInterface.dx";
            par = "appsercet="+newAppsercet+"&method=get.dxWeb.querysetup&type=6";
            var data = getSign(url,par); 
            console.log(data)
            ////修改投诉和反馈功能设置
            var validate;
            var validate = document.querySelectorAll(".validate");//获取所有的input标签对象 
            if(validate[0].checked = true){
                validate = 1;
            }else{
                validate = 2; 
            }
            var url = src + "/adminInterface.dx";
            par = "appsercet="+newAppsercet+"&method=get.dxWeb.validate&validate="+validate;
            
            var data = getSign(url,par); 
            console.log(data)
            var inputs = document.querySelectorAll(".t1");//获取所有的input标签对象  
            var tall = document.querySelector(".tall");
            if(tall.checked = true){
                
                var checkboxArray = [];//初始化空数组，用来存放checkbox对象。
                    for (var i = 0; i < inputs.length; i++) {
                    var obj = inputs[i];
                    obj.checked = true;
                }
            }
            //判断该角色是否有权限操作
            if (item.dxRightsTwoList.length == 0) {
                return
            }
            else {
                $.each(item.dxRightsTwoList, function (i, obj) {
                    //判断该用户是否有查看权限
                    if (obj.method === "get.dxWeb.feedbackDetails") {
                        $(".details").show(); 
                         //管理反馈内容选项卡下详情点击事件
                        $(".details").click(function(){
                            var id = $(this).attr("data-id");
                            $(".nv91-mask").fadeIn();
                            $(".nv92").show();
                            par = "appsercet="+newAppsercet+"&method=get.dxWeb.feedbackDetails&id="+id;
                            url = src + "/complaintInterface.dx"
                            
                            var data = getSign(url,par);
                            $(".re1").html(data.msg.complaint_name);
                            $(".re2").html(data.msg.feedback_content);
                            $(".re3").html(data.msg.ip_addr);
                            $(".re4").html(data.msg.create_time);
                            $(".re5").html(data.msg.feedback_content);
                        })                     
                    }
                    //判断该用户是否有删除权限
                    if (obj.method === "get.dxWeb.deleteFfeedback") {
                        $(".isDelete").show(); 
                       $(".isDelete").click(function(){
                        var IdList;
                            var checkboxArray = [];//初始化空数组，用来存放checkbox对象。
                            for (var i = 0; i < inputs.length; i++) {
                            var obj = inputs[i];
                            if (obj.type == 'checkbox') {
                                checkboxArray.push(obj);
                                }
                            }
                        IdList = new Array();
                            for (var i = 0; i < checkboxArray.length; i++) {
                                if (checkboxArray[i].checked)
                                IdList.push(checkboxArray[i].getAttribute("data-id"));
                            }
                            url = src + "/complaintInterface.dx";
                            par = "IdList="+IdList+"&method=get.dxWeb.deleteFfeedback&appsercet="+newAppsercet;
                            var data = getSign(url,par);
                            if(data.msg.code == "200"){
                                location.reload();
                            }
                       })                   
                            }
                    //判断该用户是否有分类反馈查看类别权限 
                    if (obj.method === "get.dxWeb.dxComplaintCateList") {
                       $(".lookType").show(); 
                       url = src+"/complaintInterface.dx";
                       par = "appsercet="+newAppsercet+"&method=get.dxWeb.dxComplaintCateList";
                       
                       var data = getSign(url,par); 
                       console.log(data);
                       if(data.dxComplaintCateList.length > 0){
                           var str = "";
                           $.each(data.dxComplaintCateList,function(i,item){
                            str+='<tr style="border-bottom: 1px solid #dddddd;">';
                            str+="<td>"+item.cate_name+"</td>"
                            if(item.state == 1){
                                str+="<td>文本框</td>";
                            }else{
                                str+="<td>复选框</td>";
                            }
                            
                            if(item.must_fill == 1){
                                str+="<td>&#10003;</td>";
                            }else{
                                str+="<td>&#10007;</td>";
                            }
                            if(item.enabled == 1){
                                str+="<td>&#10003;</td>";
                            }else{
                                str+="<td>&#10007;</td>";
                            }
                            str+='<td><a href="" style="color:#FF5456;" class="deleteType" data-id="'+item.id+'">删除</a></td>'
                            str+="</tr>";
                           })
                           $(".double").append(str)
                           
                       }                     
                    }
                    //判断是否有添加反馈类别权限
                    if (obj.method === "get.dxWeb.addDxComplaintCate") {
                        $(".addInput").show();
                         //功能设置添加留言项事件点击
                        $(".addInput").click(function(){
                            $(".nv91-mask").fadeIn();
                            $(".nv91").show();
                            $(".addProject").click(function(){
                                var cateName,state
                                cateName = $(".newProject").val();
                                var state  = document.querySelectorAll(".state");
                                if(state[0].checked = true){
                                    state = 1;
                                }else{
                                    state = 2;
                                }
                                var state1  = document.querySelectorAll(".state1");
                                if(state1[0].checked = true){
                                    state1 = 1;
                                }else{
                                    state1 = 2;
                                }
                                var state2  = document.querySelectorAll(".state2");
                                if(state2[0].checked = true){
                                    state2 = 1;
                                }else{
                                    state2 = 0;
                                }
                               
                                url = src+"/complaintInterface.dx";
                                par = "appsercet="+newAppsercet+"&cateName="+cateName+"&state="+state+"&method=get.dxWeb.addDxComplaintCate&mustFill="+state1+"&enabled="+state2;
                                
                                var data = getSign(url,par);
                                return;
                                if(data.msg.code == "200"){
                                    // location.reload();
                                }
                            })
                           
                        });                        
                    }
                    //判断是否有删除反馈类别权限
                    if (obj.method === "get.dxWeb.deleteDxComplaintCate") {
                       $(".deleteType").show();
                       $('.deleteType').click(function(){
                           var id = $(this).attr("data-id");
                           url = src+"/complaintInterface.dx";
                        par = "appsercet="+newAppsercet+"&method=get.dxWeb.deleteDxComplaintCate&cateId="+id;
                        
                        getSign(url,par);
                       })
                       
                    }
                })
            }
        }
    })

    //底部页码
    // getPage();

</script>

