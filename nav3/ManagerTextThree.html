<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>管理文章</title>
    <link rel="stylesheet" href="../css/public.css">
    <link rel="stylesheet" href="../css/bootstrap.css">
    <link rel="stylesheet" href="../css/setting.css">
    <link rel="stylesheet" href="../css/index.css">
<link rel="stylesheet" type="text/css" href="http://www.jq22.com/jquery/font-awesome.4.6.0.css">
<link rel="stylesheet" type="text/css" href="../css/buind.css">
<script src="../js/jquery-1.10.2.min.js"></script>
<script src="../js/bootstrap.min.js"></script>
<style>
.table th, .table td{vertical-align: middle;}
/*.isLook{display: none;}*/
</style>
</head>
<body style="background-color:#f3f3f3;width: inherit;box-sizing: border-box;">
        <div class="brand" style="background-color:#fff!important;height:135px;margin-bottom: 50px;">
            <ul class="breadcrumb" style="font-size: 14px;margin:25px 0;">
            <li><a href="#" style="color:#8D8D8D;">帮助文档</a>&nbsp;/&nbsp;</li>
            <li><a href="#" style="color:#5A5A5A;">管理文章</a></li>
        </ul>
        <h1>管理文章</h1>
    </div>
   <div class="" style="margin-top:50px;padding: 0 70px;width: 100%;box-sizing: border-box;">
    <div style="width: 100%;background-color: #fff;padding:40px 20px;box-sizing: border-box;">
        <div class="form-group flex justify" style="padding-bottom: 2%;">
            <div class="flex" style="width: 50%;">
                <div class="" style="text-align: center;margin-right: 3%;">
                    <button class="btn btn-primary addText saveBtn">添加文档</button>
                </div>
                <div class="" style="text-align: center;margin-right: 3%;">
                    <button class="btn deleteText">删除选中</button>
                </div>
                <div class="col-sm-4" style="text-align: center;">
                    <select name="" id="" class="form-control changeSelect">
                        <option selected="selected" value="0">--请选择-- </option>
                        <option value="">请选择问题分类</option>
                        <option value="">1</option>
                    </select>
                </div>
            </div>
            <div class="flex" style="width: 50%;text-align: right;">
                <div class="col-sm-8" style="margin-left: 25%;">
                    <div class="position">
                        <input type="text" class="form-control titleText" placeholder="请输入文章标题" />
                        <span style="font-family: iconfont;position: absolute;right: 1%;top:0;font-size: 24px;" class="titleText1">&#xe615;</span>
                    </div>
        
                </div>
            </div>
        </div>
        <table class="table" style="width: 100%;overflow: hidden;">
            <thead>
                <tr style="border-bottom: 1px solid #d8d8d8;">
                    <td class="position">
                        <div class="radio radio-info radio-inline">
                            <input type="radio" id="m3" value="option1" name="radioInline" checked="">
                            <label for="m3"> 文档管理 </label>
                        </div>
                    </td>
                    <td>文档分类</td>
                    <td>文章作者</td>
                    <td>阅读量</td>
                    <td>置顶</td>
                    <td>发布时间<img src="../image/u2372.png" alt="" style="display: inline-block;vertical-align: middle;width: 10px;height:18;margin-left: 1%;"></td>
                    <td style="font-weight: 600;">操作</td>
                </tr>
            </thead>
            <tbody class="textList">
                <tr style="border-bottom: 1px solid #d8d8d8;">
                    <td>
                        <div class="checkbox checkbox-primary">
                            <input type="checkbox" class="styled styled-primary" id="mc1" value="option2" checked="false"
                                aria-label="Single checkbox Two">
                            <label for="mc1">这是文档标题
                            </label>
                        </div>
                    </td>
                    <td>文档分类一 </td>
                    <td>陆仁贾 </td>
                    <td>100</td>
                    <td>&#10005;</td>
                    <td>2019-02-20 11:40:08</td>
                    <td style="color:#FF5456;"><span class="b1">删除</span>&nbsp;<span class="isEdit">编辑</span>&nbsp;<span class="isLook">查看</span></td>
                </tr>
            </tbody>
        </table>
        <div class="paging flex justify">
            <div style="color:#929292;font-size: 14px;padding-left: 20px;">共<span>400</span>条数据&nbsp;第<span>1</span>/<span>80</span>页</div>
            <div style="width:50%;">
                <ul class="pageList flex " style="width:auto;justify-content: flex-end;">
                    <li>&lt;</li>
                    <li class="colorActive">1</li>
                    <li>2</li>
                    <li>3</li>
                    <li>4</li>
                    <li>5</li>
                    <li>&gt;</li>
                    <li>10条/页</li>
                    <li>跳至<input type="number" class="btn" style="width:50px;height:30px;border-radius:5px;">页</li>
                </ul>
            </div>
        </div>
    </div>
</div>
   <footer class="footer">
        <p>Copyright 2017 中国东信云通信平台 All Right Reserved 中国—东盟信息港股份有限公司北京分公司
         </p>
        <p>增值电信业务经营许可证：B2-20180289 涉密信息系统集成许可证：JC301700083</p>
         
         <p>桂ICP备16005301号-7 桂公网安备45010802000099号</p>
    </footer>
</body>
</html>
<script src="../js/MD5.js"></script>
<script src="../js/api.js"></script>
<script src="../js/getRequest.js"></script>
<script type="text/javascript">
    $(document).ready(function(){
        function changeState(el) {
            if (el.readOnly) el.checked=el.readOnly=false;
            else if (!el.checked) el.readOnly=el.indeterminate=true;
        } 
         //管理文章页面表格数据渲染方法封装
         function render2(data) {
             if(data.dxWebList){
                $(".textList").html("");
                if (data.dxWebList.length > 0) {
                var str = "";
                $.each(data.dxWebList, function (i, item) {
                    str += '<tr style="border-bottom: 1px solid #d8d8d8;">';
                    str += '<td><div class="checkbox checkbox-primary"><input type="checkbox" class="styled styled-primary t1" id="' + item.id + '"   aria-label="Single checkbox Two" data-id="' + item.id + '"><label for="' + item.id + '">' + item.title + '</label></div></td><td data-id="' + item.cate_id + '">' + item.cate_id + '</td><td>' + item.author + '</td><td>' + item.browse + '</td>';
                    if (item.is_ups == 1) {
                        str += "<td>&#10003;</td>";
                    } else {
                        str += "<td>&#10007;</td>"
                    }
                    str += '<td>' + item.release_time + '</td><td style="color:#FF5456;"><span class="isDelete" data-id="' + item.id + '">删除</span>&nbsp;&nbsp;<span data-id="' + item.id + '" class="isLook">查看</span>&nbsp;&nbsp;<span class="isEdit" data-id="' + item.id + '">编辑</span></td>'
                    str += "</tr>";
                })
                $(".textList").html(str);
            }       
             }
           
        }
         //初次加载页面渲染表格数据
        var appsercet = window.localStorage.getItem("appsercet");
        appsercet = JSON.parse(appsercet);
        var newAppsercet = appsercet.data;
        url = src + "/helpInterface.dx"
        par = "appsercet="+newAppsercet+"&method=get.dxWeb.helpList";
            var data = getSign(url,par);
            console.log(data);
            render2(data);
             //渲染帮助文档下问题分类下拉框列表 
             par = "appsercet="+newAppsercet+"&method=get.dxWeb.cateAllList";
                var data1 = getSign(url,par);
                console.log(data1);
                if(data1.dxWebList.length > 0){
                    var str = "";
                    $(".changeSelect").html("");
                    str+="<option value='0' selected data-id='0'>请选择</option>";
                    $.each(data1.dxWebList,function(i,obj){
                        str+="<option data-id='"+obj.cate_id+"' value='"+obj.cate_id+"'>"+obj.cate_name+"</option>"
                    })
                    $(".changeSelect").html(str);
                } 
            //进行判断
            judgePower();
        //通过文章标题查看列表
        $(".titleText1").click(function () {
            var title1 = $(".titleText").val();
            par = "appsercet=" + newAppsercet + "&method=get.dxWeb.helpList&title=" + title1;
            var data = getSign(url, par);
            
            if(data.msg && data.msg.code == 10){
                $(".textList").html("");
            }else{
                render2(data);
                judgePower();
            }
        })
        //通过类别id查看列表
        var cateId;
        var changeSelect = document.querySelectorAll(".changeSelect option");
        $(".changeSelect").change(function () {
            var cateId = $(".changeSelect option:checked").attr("data-id");
            if(cateId == 0){
                par = "appsercet=" + newAppsercet + "&method=get.dxWeb.helpList";
                var data = getSign(url, par);
                render2(data);
                judgePower();
            } else {
                par = "appsercet=" + newAppsercet + "&method=get.dxWeb.helpList&cateId=" + cateId;
                var data = getSign(url, par);
                if (data.msg && data.msg.code == "200") {
                    $(".textList").html("");
                } else {
                    render2(data);
                    judgePower();
                }
            }
            
        })      
        //时间函数调用
        // Datetime();
       
  //删除函数封装
        function deleteText() {
            var inputs = document.querySelectorAll(".t1");//获取所有的input标签对象  
            var IdList;
            var checkboxArray = [];//初始化空数组，用来存放checkbox对象。
            for (var i = 0; i < inputs.length; i++) {
                var obj = inputs[i];
                if (obj.type == 'checkbox') {
                    checkboxArray.push(obj);
                }
            }
            IdList = new Array();
            for (var i = 0; i < checkboxArray.length; i++) {
                if (checkboxArray[i].checked) {
                    IdList.push(checkboxArray[i].getAttribute("data-id"));
                }
            }
            par = "appsercet=" + newAppsercet + "&method=get.dxWeb.deleteHelp&IdList=" + IdList;
            var data = getSign(url, par);
            console.log(data)
            if (data.msg.code == "200") {
                // alert("删除成功");
                location.reload();
            }
        }

    }) 
    //进行增删改查操作后进行权限判断
    function judgePower(){
         //首先刚开始加载页面的时候从缓存中读取之前存入的 id  以及 method名
         var node = localStorage.getItem("node");
        node = JSON.parse(node);
        var method = node.method;
        var id = node.id;
        var url,par; 
        url = src + "/helpInterface.dx";
        var fileDom      
        var appsercet = window.localStorage.getItem("appsercet");
        appsercet = JSON.parse(appsercet);
        var appid = localStorage.getItem("appid");
        console.log(appid)
        var newAppsercet = appsercet.data;
        //从缓存中读取权限，判断是否有增删改查权限
        //页面初次渲染加载数据      
        var data = window.localStorage.getItem("dxRightsList");  
        data = JSON.parse(data);  
        var appsercet = window.localStorage.getItem("appsercet");
        appsercet = JSON.parse(appsercet);
        var newAppsercet = appsercet.data;
        //判断是否有添加管理员操作权限     
        // return
        var arr = [];
        $.each(data,function(i,item){
            //判断是否是从缓存中读取的id
            if(item.id == id){
                arr.push(item)
            }
        })
        //console.log(arr[0]); 
        $.each(arr[0].dxRightsList,function(i,item){
            // 判断是否是从缓存中读取的方法名
            if(item.method === method){
                
                //判断该角色是否有权限操作
                if(item.dxRightsTwoList.length == 0){
                    return
                }
                else{                 
                    $.each(item.dxRightsTwoList,function(i,obj){
                       //判断该用户是否有添加文档权限
                        if(obj.method === "get.dxWeb.addHelp"){  
                            
                            $(".addText").show();
                            $(".addText").click(function () {
                              
                                localStorage.setItem("url","/helpInterface.dx");
                                localStorage.setItem("method","get.dxWeb.addHelp")
                                location.href = "../nav2/AddText.html"
                            
                        })      
                    }                     
                            //判断是否有查看权限
                           if(obj.method === "get.dxWeb.helpDetails"){
                           $(".isLook").show();
                           $(".isLook").click(function(){
                               var id = $(this).attr("data-id");
                               var par = "appsercet="+newAppsercet+"&method=get.dxWeb.helpDetails&articleId="+id;
                               var data = getSign(url,par);
                               localStorage.setItem("textDetail",JSON.stringify(data));
                               localStorage.setItem("method","get.dxWeb.helpDetails");
                               location.href = "../nav2/AddText.html";
                           });

                        } 
                        //判断是否有删除权限
                        if(obj.method === "get.dxWeb.deleteHelp"){
                            $(".Delete").show();
                            $(".isDelete").show();
                            $(".deleteText").click(function(){
                                deleteText();
                            })
                            $(".isDelete").click(function(){
                                deleteText();                               
                            })
                        }    
                          //判断是否有编辑员工权限
                          if (obj.method === "get.dxWeb.updateHelp") {
                         $(".isEdit").show();
                         $(".isEdit").click(function(){
                             debugger
                            var id = $(this).attr("data-id");
                               var par = "appsercet="+newAppsercet+"&method=get.dxWeb.helpDetails&articleId="+id;
                               var data = getSign(url,par);
                               console.log(data)
                               debugger
                               localStorage.setItem("textDetail",JSON.stringify(data));
                               localStorage.setItem("method","get.dxWeb.updateHelp");
                               location.href = "../nav2/AddText.html";
                         })
                        }           
                    })                   
                }
            }
        })
    }
</script>







