<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>个人认证审核</title>
    <link rel="stylesheet" href="../css/public.css">
    <link rel="stylesheet" href="../css/bootstrap.css">
    
    <link rel="stylesheet" href="../css/index.css">
    <link rel="stylesheet" href="../css/newPage.css">

    <link rel="stylesheet" type="text/css" href="http://www.jq22.com/jquery/font-awesome.4.6.0.css">
    <link rel="stylesheet" type="text/css" href="../css/buind.css">
    <script src="../js/jquery-1.10.2.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script  src="../js/newPage.js"></script>
    <style>
        .table th, .table td{vertical-align: middle;}
        .table td:first-child{
    text-align: left;
    padding-left: 30px;
    }
    </style>
</head>
<body class="bgf3">
    <div class="brand h135">
        <ul class="breadcrumb f14">
            <li><a href="#" class="color color_8d">中台用户管理</a>&nbsp;/&nbsp;</li>
            <li><a href="#"  class="color color_5a">个人认证审核</a></li>
        </ul>
        <h1>个人认证审核</h1>
</div>
<div class="" style="margin-top:50px;padding: 0 70px;width: 100%;box-sizing: border-box;">
    <div style="width: 100%;padding:40px 20px;box-sizing: border-box;">
        <div class="form-group flex justify" style="background-color: #fff;padding:40px 20px;margin:0;">
            <div class="flex" style="width: 100%;justify-content: space-between;padding-bottom: 20px;">
                <div class="col-sm-5 flex">
                    <label for="" class="label-control" style="font-size: 20px;font-weight: normal;line-height: 1.5;">状态:&nbsp;&nbsp;</label>
                    <div class="col-sm-8">
                        <select name="" id="" class="form-control companyType" style="font-size: 18px;padding:0 0 0 15px;">
                            <option value="3">请选择</option>
                            <option value="0">未审核</option>
                            <option value="1">已通过</option>
                            <option value="2">未通过</option>
                        </select>
                    </div>
                </div>

                <div class="col-sm-5   " style="text-align: right;">
                    <div class="position">
                        <input type="text" class="form-control companyName" placeholder="请输入姓名" style="font-size: 18px;"/>
                        <span style="font-family: iconfont;position: absolute;right: 1%;top:0;font-size: 24px;"
                              class="companyName1">&#xe615;</span>
                    </div>
                </div>
            </div>
           
        </div>
       
        <table class="table" style="width: 100%;overflow: hidden;">
            <thead style="border: 1px solid #CCCCCC;">
            <tr style="border-bottom: 1px solid #d8d8d8;height:70px;font-size: 18px;">
                <td >
                    姓名 
                    </div>
                </td>
                <td>状态</td>
                <td>操作时间</td>
                <td style="font-weight: 600;">操作</td>
            </tr>
            </thead>
            <tbody class="textList" style="background-color:#fff;">

            </tbody>
        </table>
        
    </div>
    <div class="paging flex " style="width:100%;justify-content: flex-end;">
        <div id="pagination13" class="pagination"></div>
    </div>
</div>

<div class="nv91-mask" >
    <!--确认 取消-->
    <div class="confirm">
            <div  class="boxTotal">
                <img src="../image/hint.png" class="boxImg"/>
                <span class="boxDelete">确定要删除这条消息吗?</span>
                </div>
                <div class="dele">
                <button class="roleRefu  roleRefuse5">取消</button>
                <button class="roleSur roleSure">确定</button>
            </div>
        </div>
        <div class="confirm1">
            <div  class="boxTotal">
                <img src="../image/hint.png" class="boxImg"/>
                <span class="boxDelete prompt">确定要删除这条消息吗?</span>
                </div>
               
        </div>
        <div class="nv1">
            <img src="../image/success.png" class="success1"/>
            <span class="referMes prompt">删除成功</span>
        </div>
        <div class="nv3">
            <img src="../image/close12.png" class="success1"/>
            <span class="referMes prompt">删除失败</span>
        </div>
</div>
<footer class="footer">
    东信在线门户运营后台
</footer>
</body>
</html>
<script src="../js/MD5.js"></script>
<script src="../js/api.js"></script>
<script src="../js/login.js"></script>
<script src="../js/getRequest.js"></script>
<script src="../js/ztPage.js"></script>
<script type="text/javascript">
    //初次加载渲染页面
    url = zt + "operationSupport/getPersonalAuthInfoList";
    var data12 = JSON.stringify({
        "pageSize": "10",
        "currentPage": "1"
    })
    var data1 = ajax(url, data12);
    render3(data1);
    judge();
    pageChange("operationSupport/getPersonalAuthInfoList",data1,"pagination13");
    //通过种类请求公司
$(".companyType").change(function () {
    url = zt + "operationSupport/getPersonalAuthInfoList";
    if ($(".companyType option:checked").val() == 3) {
        url = zt + "operationSupport/getPersonalAuthInfoList";

        var data12 = JSON.stringify({ "pageSize": "10", "currentPage": "1" }); var jsonData = ajax(url, data12);
        render3(jsonData);
        judge();
        pageChange("operationSupport/getPersonalAuthInfoList",data1,"pagination13");

    }
    if ($(".companyType option:checked").val() == 0) {
        url = zt + "operationSupport/getPersonalAuthInfoList";

        var data12 = JSON.stringify({ "pageSize": "10", "currentPage": "1" ,"authStatus":"0"}); var jsonData = ajax(url, data12);
        render3(jsonData);
        judge();
        pageChange("operationSupport/getPersonalAuthInfoList",jsonData,"pagination13");

    } else if ($(".companyType option:checked").val() == 1) {

        var data12 = JSON.stringify({ "pageSize": "10", "currentPage": "1", "authStatus":"1" });
        var jsonData = ajax(url, data12);
        render3(jsonData);
        judge();
        pageChange("operationSupport/getPersonalAuthInfoList",jsonData,"pagination13")
    } else if ($(".companyType option:checked").val() == 2) {

        var data12 = JSON.stringify({ "pageSize": "10", "currentPage": "1", "authStatus":"2" });
        var jsonData = ajax(url, data12);
        render3(jsonData);
        judge();
        pageChange("operationSupport/getPersonalAuthInfoList",jsonData,"pagination13");

    }
})
//通过姓名请求公司
$(".companyName1").click(function () {
    var companyName = $(".companyName").val();
    url = zt + "operationSupport/getPersonalAuthInfoList";
    
    var data12 = JSON.stringify({ "pageSize": "10", "currentPage": "1", "idName": companyName });
    var jsonData = ajax(url, data12);
    render3(jsonData);
    judge();
    pageChange("operationSupport/getPersonalAuthInfoList",jsonData,"pagination13")

})
    $(".btn1").each(function(index){
    $(this).hover(function(){
        $(".btn1").removeClass("btn-primary").eq(index).addClass("btn-primary");
    })
    $(this).mouseleave(function(){
        $(".btn1").removeClass("btn-primary").eq(index).addClass("btn-primary");
    })
})
    $(".btn1").each(function(index){
            $(this).click(function(){
                $(".btn1").removeClass("btn-primary").eq(index).addClass("btn-primary");
            })
       })
    //radio点击取消选中
    $(function () {
        $('input:radio').click(function () {
            //alert(this.checked);
            //

            var domName = $(this).attr('name');

            var $radio = $(this);
            // if this was previously checked
            if ($radio.data('waschecked') == true) {
                $radio.prop('checked', false);
                var inputs = document.querySelectorAll(".t1");//获取所有的input标签对象  
                var IdList;
                var checkboxArray = [];//初始化空数组，用来存放checkbox对象。
                for (var i = 0; i < inputs.length; i++) {
                    var obj = inputs[i];
                    if (obj.type == 'checkbox') {
                        obj.checked = false;
                    }
                }
                $("input:radio[name='" + domName + "']").data('waschecked', false);
                //$radio.data('waschecked', false);
            } else {
                $radio.prop('checked', true);
                var inputs = document.querySelectorAll(".t1");//获取所有的input标签对象  
                var IdList;
                var checkboxArray = [];//初始化空数组，用来存放checkbox对象。
                for (var i = 0; i < inputs.length; i++) {
                    var obj = inputs[i];
                    if (obj.type == 'checkbox') {
                        obj.checked = true
                    }
                }
                $("input:radio[name='" + domName + "']").data('waschecked', false);
                $radio.data('waschecked', true);
            }
        });
    });
    function ajax(url,data12) {
        var result = "";

        $.ajax({
            url: url,
            type: 'POST',
            async:false,
            data: data12,
            contentType: false,
            processData: false,
            success: function (res) {

                console.log(res);
                var jsonData = JSON.stringify(res);
                jsonData = JSON.parse(jsonData)
                console.log(jsonData);
                result = jsonData;
            },
            error: function (error) {
                console.log(error)
            }
        })
        return result
    }
    //批量操作获取选中的列表项
    function t1(){
        var id;
        var inputs = document.querySelectorAll(".t1");//获取所有的input标签对象
        var IdList;
        var checkboxArray = [];//初始化空数组，用来存放checkbox对象。
        for (var i = 0; i < inputs.length; i++) {
            var obj = inputs[i];
            if (obj.type == 'checkbox') {
                checkboxArray.push(obj);
            }
        }
        IdList = new Array();
        for (var i = 0; i < checkboxArray.length; i++) {
            if (checkboxArray[i].checked) {
                IdList.push(checkboxArray[i].getAttribute("data-id"));
            }
        }
        id = IdList.join(",");
        return id
    }
    //封装初次渲染方法
    function render3(data1) {
        if (data1.success) {
            $(".textList").html("");
            if (data1.body.data) {
                var str = "";
                if (data1.body.data.length > 0) {
                    $.each(data1.body.data, function (i, item) {
                        str += '<tr style="border-bottom: 1px solid #d8d8d8;">';
                        str += '<td>'+item.idName +'</td>';

                        if (item.authStatus == 0) {
                            str += "<td>未审核</td>";
                        } else if (item.authStatus == 1) {
                            str += "<td>已通过</td>"
                        } else if (item.authStatus == 2) {
                            str += "<td>未通过</td>"
                        }
                        str += '<td>' + item.updateTime + '</td><td style="color:#48a4ea;">&nbsp;&nbsp;<span data-id="' + item.id + '" class="isEdit" data-statu="'+item.authStatus+'">详情</span>&nbsp;&nbsp;</td>'
                        str += "</tr>";
                    })
                    $(".textList").append(str);
                    judge();
                }
            }
        }
    }
    
        function judge() {
            //页面初次渲染加载数据
            var data = window.localStorage.getItem("dxRightsList");
            data = JSON.parse(data);
            //页面初次加载渲染页面
            var url, par;
            var appsercet = window.localStorage.getItem("appsercet");
            appsercet = JSON.parse(appsercet);
            var newAppsercet = appsercet.data;
            //判断是否有添加管理员操作权限
            var arr = [];
            $.each(data, function (i, item) {
                //console.log(item)
                if (item.id == 10) {
                    arr.push(item)
                }
            })
            console.log(arr[0]);
            $.each(arr[0].dxRightsList, function (i, item) {
                //console.log(arr[0].dxRightsList)
                if (item.link_path === "personalAddList") {

                    //判断该角色是否有权限操作
                    if (item.dxRightsTwoList.length == 0) {
                        return
                    }
                    else {
                        $.each(item.dxRightsTwoList, function (i, obj) {

                            //判断该用户是否有删除权限
                            if (obj.link_path === "delete") {
                                $(".Delete").show();
                                $(".isDelete").show();
                                $(".Delete").click(function () {
                                    var pageNum = localStorage.getItem("pageNow1");
                                    var id = t1();
                                    url = zt + "operationSupport/batchDeleteIdentityInfo"
                                    var data12 = JSON.stringify({ "ids": id })
                                    var data = ajax(url, data12);
                                    console.log(data);
                                    if (data.success) {
                                        $(".prompt span").text("删除成功");
                                        $(".nv91-mask").show();
                                        $(".nv").show();
                                        setTimeout(function () {
                                            $(".nv91-mask").hide();
                                            $(".nv").hide();
                                        }, 2000);
                                        url = zt + "operationSupport/getPersonalAuthInfoList";

                                        var data12 = JSON.stringify({
                                            "pageSize": "10",
                                            "currentPage": pageNum
                                        })
                                        var data1 = ajax(url, data12);
                                        render3(data1);
                                    }
                                })
                                $(".isDelete").click(function () {
                                    var id = $(this).attr("data-id");
                                    var pageNum = localStorage.getItem("pageNow1");
                                    url = zt + "operationSupport/deleteIdentityInfo"
                                    var data12 = JSON.stringify({ "id": id })
                                    var data = ajax(url, data12);
                                    if (data.success) {
                                        console.log("mmmm")
                                        $(".prompt span").text("删除成功");
                                        $(".nv91-mask").show();
                                        $(".nv").show();
                                        setTimeout(function () {
                                            $(".nv91-mask").hide();
                                            $(".nv").hide();
                                        }, 2000);

                                        url = zt + "operationSupport/getPersonalAuthInfoList";

                                        var data12 = JSON.stringify({
                                            "pageSize": "10",
                                            "currentPage": pageNum
                                        })
                                        var data1 = ajax(url, data12);
                                        render3(data1);
                                    }
                                })

                                //判断是否有查看权限
                            } if (obj.link_path === "query") {
                                //查看文章详情
                                $(".isEdit").show();
                                $(".isEdit").click(function () {
                                    var nowStatus = $(this).attr("data-statu");
                                    localStorage.setItem("nowStatus", nowStatus);
                                    var id = $(this).attr("data-id");
                                    url = zt + "operationSupport/getPersonalAuthInfo";
                                    var data12 = JSON.stringify({ "id": id })
                                    var data = ajax(url, data12);
                                    if (data.success) {
                                        localStorage.setItem("personDetail", JSON.stringify(data.body));
                                        localStorage.setItem("detailId", id);
                                        localStorage.setItem("personType", "yes");
                                        localStorage.setItem("type3", "line");
                                        location.href = "./Idetails.html";
                                    }

                                })

                            }
                            //判断是否有审核权限
                            if (obj.link_path === "auditor") {

                                $(".isVerify").show();
                                $(".isVerify").eq(0).click(function () {
                                    var pageNum = localStorage.getItem("pageNow1");
                                    var id = t1();
                                    url = zt + "operationSupport/batchUpdateIdentityInfo"
                                    var data12 = JSON.stringify({ "ids": id, "authState": 1 })
                                    var data = ajax(url, data12);
                                    if (data.success) {
                                        $(".prompt span").text("操作成功");
                                        $(".nv91-mask").show();
                                        $(".nv").show();
                                        setTimeout(function () {
                                            $(".nv91-mask").hide();
                                            $(".nv").hide();
                                        }, 2000);
                                        url = zt + "operationSupport/getPersonalAuthInfoList";

                                        var data12 = JSON.stringify({
                                            "pageSize": "10",
                                            "currentPage": pageNum
                                        })
                                        var data1 = ajax(url, data12);
                                        render3(data1);
                                    }
                                })

                                $(".isVerify").eq(1).click(function () {
                                    var pageNum = localStorage.getItem("pageNow1");
                                    var id = t1();
                                    url = zt + "operationSupport/batchUpdateIdentityInfo"
                                    var data12 = JSON.stringify({ "ids": id, "authState": 2 })
                                    var data = ajax(url, data12);
                                    if (data.success) {
                                        $(".prompt span").text("操作成功");
                                        $(".nv91-mask").show();
                                        $(".nv").show();
                                        setTimeout(function () {
                                            $(".nv91-mask").hide();
                                            $(".nv").hide();
                                        }, 2000);
                                        url = zt + "operationSupport/getPersonalAuthInfoList";

                                        var data12 = JSON.stringify({
                                            "pageSize": "10",
                                            "currentPage": pageNum
                                        })
                                        var data1 = ajax(url, data12);
                                        render3(data1);
                                    }
                                })
                            }

                        })

                    }
                }

            })


        }
     //通过用户名请求
        $(".idName1").click(function () {
            var idName = $(".idName").val();
            url = zt + "operationSupport/getPersonalAuthInfoList";

            var data12 = JSON.stringify({
                "idName": idName,
                "pageSize": "10",
                "currentPage": "1"
            })
            var data1 = ajax(url, data12);
            render3(data1);
        })
    $(".roleRefuse").click(function(){
        $(".nv91-mask").hide();
        $(".nv91").hide();
    })
    $(".roleSure").click(function(){
        $(".nv91-mask").hide();
        $(".nv91").hide();
    })
   
   
    //编辑方法
    function editN(){
        $(".isEdit").click(function () {
            var nowStatus = $(this).attr("data-statu");
            localStorage.setItem("nowStatus", nowStatus);
            var id = $(this).attr("data-id");
            url = zt + "operationSupport/getPersonalAuthInfo"
            var data12 = JSON.stringify({ "id": id })
            var data = ajax(url, data12);
            if (data.success) {
                localStorage.setItem("companyDetail", JSON.stringify(data.body));
                localStorage.setItem("detailId", id);
                localStorage.setItem("personType", "yes");
                location.href = "./Idetails.html"
            }
        })
    }
    function isDelete(){
        $(".isDelete").click(function(){

            var id = $(this).attr("data-id");
            var pageNum = localStorage.getItem("pageNow1");
            url = zt + "operationSupport/deleteIdentityInfo"
            var data12 = JSON.stringify({ "id": id })
            var data = ajax(url, data12);
            if (data.success) {
                console.log("mmmm");
                $(".prompt span").text("删除成功");
                $(".nv91-mask").show();
                $(".nv").show();
                setTimeout(function () {
                    $(".nv91-mask").hide();
                    $(".nv").hide();
                }, 2000);

                url = zt + "operationSupport/getPersonalAuthInfoList";

                var data12 = JSON.stringify({
                    "pageSize": "10",
                    "currentPage": pageNum
                })
                var data1 = ajax(url, data12);
                render3(data1);
            }
        })
    }

</script>

