<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta http-equiv="Access-Control-Allow-Origin" content="*">

    <title>企业认证审核</title>
    <link rel="stylesheet" href="../css/public.css">
    <link rel="stylesheet" href="../css/bootstrap.css">
    <link rel="stylesheet" href="../css/setting.css">
    <link rel="stylesheet" href="../css/index.css">
    <link rel="stylesheet" type="text/css" href="http://www.jq22.com/jquery/font-awesome.4.6.0.css">
    <link rel="stylesheet" type="text/css" href="../css/buind.css">
    <link rel="stylesheet" href="../css/page.css">
    <script src="../js/jquery-1.10.2.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <style>
        .table th, .table td{vertical-align: middle;}
        .isLook,.isVerify,.Delete{display: none;}
        .editType{width: 140px;height:60px;background-color: #fff;border: 1px solid #ccc;border-radius: 5px;position: absolute;top:10px;left: 20px;display: none;}
        .isEdit{position: relative;}
        .type2,.type3{width: 100%;height:24px;margin-top: 5px;display: block;list-style: none;font-style: normal;color:#222;border: 1px solid #ccc;background-color: #dddddd;}
        *{ margin:0px; padding:0px;}
        ul{ list-style:none;}
        body{ font-size:12px;}

    </style>
</head>
<body style="background-color:#f3f3f3;width: inherit;box-sizing: border-box;">
<div class="brand" style="background-color:#fff!important;height:135px;margin-bottom: 50px;">
    <ul class="breadcrumb" style="font-size: 14px;margin:25px 0;">
        <li><a href="#"  class="color">中台用户管理</a>&nbsp;/&nbsp;</li>
        <li><a href="#"  class="color">企业认证审核</a></li>
    </ul>
    <h1>企业认证审核</h1>
</div>
<div class="" style="margin-top:50px;padding: 0 70px;width: 100%;box-sizing: border-box;">
    <div style="width: 100%;padding:40px 20px;box-sizing: border-box;">
        <div class="form-group flex justify" style="background-color: #fff;padding:40px 20px;margin:0;">
            <div class="flex" style="width: 100%;justify-content: space-between;padding-bottom: 20px;">
                <div class="col-sm-5 flex">
                    <label for="" class="label-control" style="font-size: 20px;font-weight: normal;line-height: 1.5;">认证用户:</label>
                    <div class="col-sm-8">
                        <select name="" id="" class="form-control companyType" style="font-size: 18px;padding:0 0 0 15px;">
                            <option value="0">请选择</option>
                            <option value="2">企业</option>
                            <option value="3">个人转企业</option>
                        </select>
                    </div>
                </div>

                <div class="col-sm-5   " style="text-align: right;">
                    <div class="position">
                        <input type="text" class="form-control companyName" placeholder="请输入企业名称" style="font-size: 18px;"/>
                        <span style="font-family: iconfont;position: absolute;right: 1%;top:0;font-size: 24px;"
                              class="companyName1">&#xe615;</span>
                    </div>
                </div>
            </div>
            <div class="flex" style="font-size: 18px;">
                <button class="btn isVerify" style="color:#fff;background-color: #E2302B;font-size: 18px;">审核通过</button>
                <button class="btn isVerify" style="margin:0 10px;font-size: 18px;">审核不通过</button>
                <button class="btn Delete" style="font-size: 18px;">删除</button>

            </div>
        </div>
        <table class="table" style="width: 100%;overflow: hidden;">
            <thead style="background-color: #F3F3F3;border: 1px solid #CCCCCC;">
            <tr style="border-bottom: 1px solid #d8d8d8;background-color: #F3F3F3;height: 70px;font-size: 18px;">
                <td class="position">
                    <div class="radio radio-info radio-inline">
                        <input type="radio" id="m1" value="" name="check1" >
                        <label for="m1"> 企业名称 </label>
                    </div>
                </td>
                <td>统一社会信用代码</td>
                <td>法人姓名</td>
                <td>类型</td>
                <td>状态</td>
                <td>操作时间</td>
                <td style="font-weight: 600;">操作</td>
            </tr>
            </thead>
            <tbody class="textList" style="background-color:#fff;">

            </tbody>
        </table>
        <div class=" flex " style="width:100%;justify-content: space-between;" >
            <div  style="font-size:14px;margin-top:30px;">
                <span>共<i class="totalCount">100</i>条数据</span>
                <span>第<i class="nowNum">1</i>/<i class="pagenumber">80</i>页</span>
            </div>
            <div id="pageGro">
                <div class="pageUp">&lt;</div>
                <div class="pageList">
                    <ul>
                        <li>1</li>
                        <li>2</li>
                        <li>3</li>
                        <li>4</li>
                        <li>5</li>
                    </ul>
                </div>
                <div class="pageDown">&gt;</div>
                <button class="btn" style="margin-left: 10px;">10条/页</button>
                <span  style="margin-left: 10px;">跳转<input type="number" class="btn returnNum" style="width:60px;margin:0 10px;">页</span>

            </div>
        </div>
    </div>

</div>
<div class="nv91-mask" >
    <div class="nv" style="padding:10px;">
        <div class="nv91-close">X</div>
        <form action="" class="form-horizontal" role="form" >
            <div class="prompt" style="padding-bottom:30px;">
                <p style="font-size: 20px;">提示</p>
                <img src="" alt="" ><span style="font-size:18px;"></span>
            </div>
            <div class="form-group flex butto" style="justify-content: flex-end;box-sizing: border-box;">
                <div class="col-sm-2" style="margin-top: 1%;margin-right:2%;">
                    <button class="btn btn-primary roleSure">确定</button>
                </div>
                <div class="col-sm-2" style="margin-top: 1%;margin-right:2%;">
                    <button class="btn  roleRefuse">取消</button>
                </div>
            </div>
        </form>
    </div>
</div>
<footer class="footer">
    <p>Copyright 2017 中国东信云通信平台 All Right Reserved 中国—东盟信息港股份有限公司北京分公司
    </p>
    <p>增值电信业务经营许可证：B2-20180289 涉密信息系统集成许可证：JC301700083</p>

    <p>桂ICP备16005301号-7 桂公网安备45010802000099号</p>
</footer>
</body>
</html>
<script src="../js/MD5.js"></script>
<script src="../js/api.js"></script>
<script src="../js/getRequest.js"></script>
<script src="../js/page.js"></script>
<script type="text/javascript">
    localStorage.setItem("pageNow1",1);
    //radio点击取消选中
    $(function () {
        $('input:radio').click(function () {
            //alert(this.checked);
            //

            var domName = $(this).attr('name');

            var $radio = $(this);
            // if this was previously checked
            if ($radio.data('waschecked') == true) {
                $radio.prop('checked', false);
                var inputs = document.querySelectorAll(".t1");//获取所有的input标签对象  
                var IdList;
                var checkboxArray = [];//初始化空数组，用来存放checkbox对象。
                for (var i = 0; i < inputs.length; i++) {
                    var obj = inputs[i];
                    if (obj.type == 'checkbox') {
                        obj.checked = false;
                    }
                }
                $("input:radio[name='" + domName + "']").data('waschecked', false);
                //$radio.data('waschecked', false);
            } else {
                $radio.prop('checked', true);
                var inputs = document.querySelectorAll(".t1");//获取所有的input标签对象  
                var IdList;
                var checkboxArray = [];//初始化空数组，用来存放checkbox对象。
                for (var i = 0; i < inputs.length; i++) {
                    var obj = inputs[i];
                    if (obj.type == 'checkbox') {
                        obj.checked = true
                    }
                }
                $("input:radio[name='" + domName + "']").data('waschecked', false);
                $radio.data('waschecked', true);
            }
        });
    });

    //页面初次渲染加载数据
    var data = window.localStorage.getItem("dxRightsList");
    data = JSON.parse(data);
    //定义总数量
    var pageCount;
    //页面初次加载渲染页面
    var url,par;
    var appsercet = window.localStorage.getItem("appsercet");
    appsercet = JSON.parse(appsercet);
    var newAppsercet = appsercet.data;
    //判断是否有添加管理员操作权限
    var arr = [];
    $.each(data,function(i,item){
        //console.log(item)
        if(item.id == 10){
            arr.push(item)
        }
    })
    $(".roleRefuse").click(function(){
        $(".nv91-mask").hide();
        $(".nv91").hide();
    })
    $(".roleSure").click(function(){
        $(".nv91-mask").hide();
        $(".nv91").hide();
    })
    //封装初次渲染方法
    function render3(jsonData) {
        if (jsonData.success) {
            $(".textList").html("");
            if (jsonData.body.data) {
                var str = "";

                if (jsonData.body.data.length > 0) {
                    $.each(jsonData.body.data, function (i, item) {
                        str += '<tr style="border-bottom: 1px solid #d8d8d8;font-size:14px;">';
                        str += '<td><div class="checkbox checkbox-primary" style="padding:10px 20px;"><input type="checkbox" class="styled styled-primary t1" id="' + item.id + '"   aria-label="Single checkbox Two" data-id="' + item.id + '"><label for="' + item.id + '">' + item.companyName + '</label></div></td><td>"' + item.businessLicense + '"</td><td>' + item.corporateName + '</td>';
                        if (item.type == 2) {
                            str += "<td>企业</td>";
                        } else {
                            str += "<td>个人转企业</td>"
                        }
                        if (item.authStatus == 0) {
                            str += "<td>未审核</td>";
                        } else if (item.authStatus == 1) {
                            str += "<td>已通过</td>"
                        } else if (item.authStatus == 2) {
                            str += "<td>未通过</td>"
                        }
                        str += '<td>' + item.updateTime + '</td><td style="color:#FF5456;"><span data-id="' + item.id + '" class="isEdit" data-value="' + i + '" data-name="'+item.type+'">查看编辑</span>&nbsp;&nbsp;<span class="isDelete" data-id="' + item.id + '">删除</span></td>'
                        str += "</tr>";
                    })
                    $(".textList").html(str);
                    judge();
                }
            }
        }
    }
    //批量操作获取选中的列表项
    function t1(){
        var id;
        var inputs = document.querySelectorAll(".t1");//获取所有的input标签对象
        var IdList;
        var checkboxArray = [];//初始化空数组，用来存放checkbox对象。
        for (var i = 0; i < inputs.length; i++) {
            var obj = inputs[i];
            if (obj.type == 'checkbox') {
                checkboxArray.push(obj);
            }
        }
        IdList = new Array();
        for (var i = 0; i < checkboxArray.length; i++) {
            if (checkboxArray[i].checked) {
                IdList.push(checkboxArray[i].getAttribute("data-id"));
            }
        }
        id = IdList.join(",");
        return id
    }
    //封装请求函数
    function ajax(url,data12) {
        var result = "";

        $.ajax({
            url: url,
            type: 'POST',
            async:false,
            data: data12,
            contentType: false,
            processData: false,
            success: function (res) {

                console.log(res);
                var jsonData = JSON.stringify(res);
                jsonData = JSON.parse(jsonData)
                console.log(jsonData);
                result = jsonData;
            },
            error: function (error) {
                console.log(error)
            }
        })

        return result
    }
    //页面初次渲染加载数据
    var data = window.localStorage.getItem("dxRightsList");
    data = JSON.parse(data);
    //页面初次加载渲染页面
    var url, par;
    var appsercet = window.localStorage.getItem("appsercet");
    appsercet = JSON.parse(appsercet);
    var newAppsercet = appsercet.data;
    //判断是否有添加管理员操作权限
    var arr = [];
    $.each(data, function (i, item) {
        //console.log(item)
        if (item.id == 10) {
            arr.push(item)
        }
    })
    console.log(arr[0]);
    $.each(arr[0].dxRightsList,function(i,item){
        //console.log(arr[0].dxRightsList)
        if(item.link_path === "enterpriseAaddList"){
            //初次加载页面渲染页面
            url = zt + "operationSupport/getCompanyAuthInfoList";

            var data12 = JSON.stringify({ "pageSize": "10", "currentPage": "1" }); var jsonData = ajax(url, data12);
            render3(jsonData);
            //页面加载完成是与后台数据交互，后台返回总页数（如果只有总条数的话就自己算。Math.ceil(总条数/每条多少页)=总页数）
            pageCount = Math.ceil(jsonData.body.totalCount/10);//后台返回的总页数
            icon_load(pageCount);
            $(".totalCount").text(jsonData.body.totalCount);
            $(".pagenumber").text(pageCount);

            //判断该角色是否有权限操作
            if(item.dxRightsTwoList.length == 0){
                return
            }
            else{
                $.each(item.dxRightsTwoList,function(i,obj){
                    //判断该用户是否有删除权限
                    if(obj.link_path === "delete"){
                        $(".Delete").show();
                        $(".isDelete").show();
                        $(".Delete").click(function(){
                            var id = t1();
                            var pageNum = localStorage.getItem("pageNow1");
                            url = zt+"operationSupport/batchDeleteIdentityInfo"
                            var data12 = JSON.stringify({"ids":id})
                            var data = ajax(url,data12);
                            console.log(data);
                            if (data.success) {
                                $(".prompt span").text("删除成功");
                                $(".nv91-mask").show();
                                $(".nv").show();
                                setTimeout(function () {
                                    $(".nv91-mask").hide();
                                    $(".nv").hide();
                                }, 2000);
                                url = zt + "operationSupport/getCompanyAuthInfoList";
                                var data12 = JSON.stringify({ "pageSize": "10", "currentPage": pageNum }); var jsonData = ajax(url, data12);
                                render3(jsonData);
                                editN();
                            }

                        })
                        isDelete();
                        //判断是否有查看权限
                    }if(obj.link_path === "query"){

                        //查看文章详情
                        $(".isEdit").show();
                        editN();

                    }
                    //判断是否有审核权限
                    if (obj.link_path === "auditor") {

                        $(".isVerify").show();
                        $(".isVerify").eq(0).click(function () {
                            var id = t1();
                            var pageNum = localStorage.getItem("pageNow1");
                            url = zt + "operationSupport/batchUpdateIdentityInfo"
                            var data12 = JSON.stringify({ "ids": id, "authState": 1 })
                            var data = ajax(url, data12);
                            console.log(data);
                            if (data.success) {
                                $(".prompt span").text("操作成功");
                                $(".nv91-mask").show();
                                $(".nv").show();
                                setTimeout(function () {
                                    $(".nv91-mask").hide();
                                    $(".nv").hide();
                                }, 2000);
                                url = zt + "operationSupport/getCompanyAuthInfoList";

                                var data12 = JSON.stringify({ "pageSize": "10", "currentPage": pageNum }); var jsonData = ajax(url, data12);
                                render3(jsonData);
                                editN();
                                isDelete();

                            }
                        })
                        $(".isVerify").eq(1).click(function () {
                            var id = t1();
                            var pageNum = localStorage.getItem("pageNow1");
                            url = zt + "operationSupport/batchUpdateIdentityInfo";
                            var data12 = JSON.stringify({ "ids": id, "authState": "2" });
                            console.log(data12);
                            var data = ajax(url, data12);
                            console.log(data);
                            if (data.success) {
                                $(".prompt span").text("操作成功");
                                $(".nv91-mask").show();
                                $(".nv").show();
                                setTimeout(function () {
                                    $(".nv91-mask").hide();
                                    $(".nv").hide();
                                }, 2000);
                                url = zt + "operationSupport/getCompanyAuthInfoList";

                                var data12 = JSON.stringify({ "pageSize": "10", "currentPage": pageNum }); var jsonData = ajax(url, data12);
                                render3(jsonData);
                                editN();
                                isDelete();

                            }
                        })
                    }
                    //通过种类请求公司
                    $(".companyType").change(function () {
                        url = zt + "operationSupport/getCompanyAuthInfoList";

                        if ($(".companyType option:checked").val() == 0) {
                            url = zt + "operationSupport/getCompanyAuthInfoList";

                            var data12 = JSON.stringify({ "pageSize": "10", "currentPage": "1" }); var jsonData = ajax(url, data12);
                            render3(jsonData);
                            editN();
                            isDelete();

                        } else if ($(".companyType option:checked").val() == 2) {

                            var data12 = JSON.stringify({ "pageSize": "10", "currentPage": "1", "type": 2 });
                            var jsonData = ajax(url, data12);
                            render3(jsonData);
                            editN();
                        } else if ($(".companyType option:checked").val() == 3) {

                            var data12 = JSON.stringify({ "pageSize": "10", "currentPage": "1", "type": 3 });
                            var jsonData = ajax(url, data12);
                            render3(jsonData);
                            editN();
                            isDelete();

                        }
                    })
                    //通过公司名请求公司
                    $(".companyName1").click(function () {
                        var companyName = $(".companyName").val();
                        url = zt + "operationSupport/getCompanyAuthInfoList"
                        var data12 = JSON.stringify({ "pageSize": "10", "currentPage": "1", "companyName": companyName });
                        var jsonData = ajax(url, data12);
                        render3(jsonData);
                        editN();
                        isDelete();

                    })
                })

            }
        }

    })
    function judge(){
        //页面初次渲染加载数据
        var data = window.localStorage.getItem("dxRightsList");
        data = JSON.parse(data);
        //页面初次加载渲染页面
        var url, par;
        var appsercet = window.localStorage.getItem("appsercet");
        appsercet = JSON.parse(appsercet);
        var newAppsercet = appsercet.data;
        //判断是否有添加管理员操作权限
        var arr = [];
        $.each(data, function (i, item) {
            //console.log(item)
            if (item.id == 10) {
                arr.push(item)
            }
        })
        console.log(arr[0]);
        $.each(arr[0].dxRightsList,function(i,item){
            //console.log(arr[0].dxRightsList)
            if(item.link_path === "enterpriseAaddList"){
                //判断该角色是否有权限操作
                if(item.dxRightsTwoList.length == 0){
                    return
                }
                else{
                    $.each(item.dxRightsTwoList,function(i,obj){


                        //判断该用户是否有删除权限 
                        if(obj.link_path === "delete"){
                            $(".Delete").show();
                            $(".isDelete").show();
                            isDelete();
                            //判断是否有查看权限
                        }if(obj.link_path === "query"){

                            //查看文章详情
                            $(".isEdit").show();
                            editN();
                        }
                        //判断是否有审核权限
                        if (obj.link_path === "auditor") {

                            $(".isVerify").show();

                        }

                    })

                }
            }

        })

    }
    //点击分页按钮触发
    $(document).on("click", "#pageGro li", function () {
        var pageNum = parseInt($(this).html());//获取当前页数
        localStorage.setItem("pageNow1",pageNum);
        var selector = $(this);
        $(".nowNum").text(pageNum);
        url = zt + "operationSupport/getCompanyAuthInfoList";
        var data12 = JSON.stringify({ "pageSize": "10", "currentPage": pageNum }); var jsonData = ajax(url, data12);
        render3(jsonData);
        num_click(pageCount, pageNum, selector);
        editN();
        isDelete();

    });
    $(".returnNum").blur(function(){
        var data12
        var pageNum = parseInt($(this).val());//获取当前页数
        localStorage.setItem("pageNow1",pageNum);
        if(pageNum == "" || pageNum == null){

        }else if(pageNum > 0 && pageNum <=pageCount){
            url = zt + "operationSupport/getCompanyAuthInfoList";

            data12 = JSON.stringify({ "pageSize": "10", "currentPage": pageNum });
        }var jsonData = ajax(url, data12);
        render3(jsonData);
        $(".nowNum").text(pageNum);
        $(this).val("");
        var selector = $("#pageGro li").eq(pageNum-1);
        num_click(pageCount, pageNum, selector);
        editN();
        isDelete();


    })
    //点击上一页触发
    $(document).on("click", "#pageGro .pageUp", function () {
        var pageNum = parseInt($("#pageGro li.on").html());//获取当前页
        localStorage.setItem("pageNow1",pageNum);
        var index = $("#pageGro ul li.on").index();//获取index
        $(".nowNum").text(pageNum - 1);
        url = zt + "operationSupport/getCompanyAuthInfoList";
        var data12 = JSON.stringify({ "pageSize": "10", "currentPage": pageNum - 1 }); var jsonData = ajax(url, data12);
        render3(jsonData);
        pageUp_click(pageCount, pageNum, index);
        editN();
        isDelete();
    });

    //点击下一页触发
    $(document).on("click", "#pageGro .pageDown", function () {
        var pageNum = parseInt($("#pageGro li.on").html());//获取当前页
        localStorage.setItem("pageNow1",pageNum);
        var index = $("#pageGro ul li.on").index();//获取index
        $(".nowNum").text(pageNum + 1);
        url = zt + "operationSupport/getCompanyAuthInfoList";

        var data12 = JSON.stringify({ "pageSize": "10", "currentPage": pageNum + 1 }); var jsonData = ajax(url, data12);
        render3(jsonData);
        pageDown_click(pageCount, pageNum, index);
        editN();
        isDelete();

    });
    //编辑方法
    function editN(){

        $(".isEdit").click(function(){
            var index = $(this).attr("data-value");
            var type = $(this).attr("data-name");
            var id = $(this).attr("data-id");
            var data12 = JSON.stringify({ "id": id });
            var url = zt + "operationSupport/getCompanyAuthInfo"
            var data = ajax(url, data12);
            if(type == 2){
                localStorage.setItem("type3", "no");
            }else{
                localStorage.setItem("type3", "yes");
            }
            // 将公司详情暂存缓存
            if (data.success) {

                localStorage.setItem("companyDetail", JSON.stringify(data.body));
                localStorage.setItem("personType", "no");

                localStorage.setItem("detailId", id);
                location.href = "./Idetails.html"
            }
        })
    }
    function isDelete(){
        $(".isDelete").click(function(){

            var id = $(this).attr("data-id");
            var pageNum = localStorage.getItem("pageNow1");
            url = zt + "operationSupport/deleteIdentityInfo"
            var data12 = JSON.stringify({ "id": id })
            var data = ajax(url, data12);
            console.log(data)
            if (data.success) {
                $(".prompt span").text("删除成功");
                $(".nv91-mask").show();
                $(".nv").show();
                setTimeout(function () {

                    $(".nv91-mask").hide();
                    $(".nv").hide();
                }, 2000);
                url = zt + "operationSupport/getCompanyAuthInfoList";

                var data12 = JSON.stringify({ "pageSize": "10", "currentPage": pageNum });
                var jsonData = ajax(url, data12);
                render3(jsonData);
            }
        })
    }

</script>


