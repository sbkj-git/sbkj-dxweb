<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>东信在线运营后台</title>
    <link rel="stylesheet" href="./css/public.css">
    <link rel="stylesheet" href="./css/bootstrap.css">
    <link rel="stylesheet" href="./css/loginOne.css">
    <link rel="stylesheet" type="text/css" href="http://www.jq22.com/jquery/font-awesome.4.6.0.css">
    <link rel="stylesheet" href="./css/buind.css">
    <link rel="shortcut icon" href="image/icon.png">
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
        }
        .checkbox label::after {
            display: inline-block;
            position: absolute;
            width: 16px;
            height: 11px;
            left: 3px;
            top: 4px;
            margin-left: -21px;
            padding-left: 1px;
            padding-top: 0px;
            font-size: 11px;
            color: #555;
        }
        .checkbox label::before {
            content: "";
            display: inline-block;
            position: absolute;
            width: 20px;
            height: 20px;
            left: 0;
            margin-left: -19px;
            margin-top: 0px;
            border: 1px solid #ccc;
            border-radius: 3px;
            background-color: #fff;
            -webkit-transition: border .15s ease-in-out, color .15s ease-in-out;
            -o-transition: border .15s ease-in-out, color .15s ease-in-out;
            transition: border .15s ease-in-out, color .15s ease-in-out;
        }
    </style>
</head>
<script src="./js/remberPass.js"></script>
<body id="body" onload="document.getElementById('username').focus();GetCookie();">
<div class="banner3" style="height: 100%">

    <div>
        <div class="banners">
            <div class="jx">
                <img src="./image/l1.png" alt="">
                <p>东信在线，让企业运转更高效</p>
            </div>
            <div class="login flex justify login_p" style="padding-top: 30px;margin-right: 56px;">
                <p>登录</p>

                <div class="div">
                    <img src="./image/l2.png" alt="" class="img" style="margin-left: 10px">
                    <input style="padding-left:50px;margin-bottom: 5px" type="text" class="input1 user" placeholder="请输入用户名称"  id="username">
                </div>
                <div class="div">
                    <img src="./image/l3.png" alt="" class="img" style="margin-left: 10px">
                    <input style="padding-left: 50px" type="password" class="input1 pass" placeholder="请输入用户密码" id="password"/>
                </div>
                <div style="width: 100%;" class="hide flex div">
                    <img src="./image/l4.png" alt="" class="img" style="margin-left: 10px">
                    <input style="padding-left: 50px" type="text" placeholder="验证码" class="input2 vister"
                           placeholder="请输入验证码">
                    <button class="qs btn btn-default" style="margin-top: 8px;margin-right: 5px">获取验证码</button>
                </div>
                <span style="margin-left: 120px;margin-top: 10px;color: red;font-size: 16px" id="error"></span>
                <button class="btnLogin" style="width: 400px;height: 50px;margin-top: 10px">登&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;录</button>

                <div class="flex remberAcount">
                    <div class='checkbox checkbox-primary' style="margin-right:10px"><input type='checkbox' class='styled styled-primary'  id="remember_password"                                                                             aria-label='Single checkbox Two'>
                        <label for='remember_password' class='rolen' style="margin-top: 2px">记住账号</label></div>
                    <span><a href="./forgetPass.html" class="forgetPass" style="font-size: 15px;">忘记密码</a></span>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer" style=" position: absolute;bottom: 0px;">
        <p>Copyright 2017 中国东信云通信平台 All Right Reserved 中国—东盟信息港股份有限公司北京分公司
        </p>
        <p>增值电信业务经营许可证：B2-20180289 涉密信息系统集成许可证：JC301700083</p>
        <p>桂ICP备16005301号-7 桂公网安备45010802000099号</p>
    </footer>
</div>
<div class="nv" style="padding:10px;">
    <div class="nv91-close">X</div>
    <form action="" class="form-horizontal" role="form" >
        <div class="prompt" style="padding-bottom:30px;">
            <p style="font-size: 20px;">警告</p>
            <img src="" alt="" ><span>操作成功</span>
        </div>

    </form>
</div>
</body>
</html>
<script src="js/jquery-1.10.2.min.js"></script>
<script src="./js/MD5.js"></script>
<!-- <script src="js/sign.js"></script> -->
<script src="./js/api.js"></script>
<script src="./js/getRequest.js"></script>
<script type="text/javascript">
    window.onload = function () {
        var height = document.documentElement.clientHeight;
        $("#body").height(height);

        // $(".login").height(height/1.75);
        function changeState(el) {
            if (el.readOnly) el.checked = el.readOnly = false;
            else if (!el.checked) el.readOnly = el.indeterminate = true;
        }

        //提交用户信息
        // window.localStorage.clear();
        var par, url, visterName, username, pwd, type, methods;
        $(".user").focus(function(){
            GetCookie();
        })
        $(".user").blur(function () {
            username = $(this).val()
            if (username==null||username.trim()=="") {
                $("#error").text("用户名不能为空!");
            }
            par = "username=" + username
        })
        $(".pass").blur(function () {
            pwd = $(this).val();
            if (pwd==null||pwd.trim()=="") {
                $("#error").text("密码不能为空!");
            }
            par = "username=" + username + "&pwd=" + pwd
        })
        $(".vister").blur(function () {
            visterName = $(this).val();
            if (visterName==null||visterName.trim()=="") {
                $("#error").text("验证码不能为空!");
            }
        })
        $(".qs").click(function () {
            url = src + "/atohCode.dx"
            phone(url)
        })
        //判断是否是要验证验证码
        var x = window.sessionStorage.getItem("n")
        if (isNaN(x) || x == null) {
            // 
            window.sessionStorage.setItem("n", 0)
            //重新判断什么时候显示验证码
            $(".btnLogin").click(function () {
                if (username==null||username.trim()=="") {
                    $("#error").text("用户名不能为空!");
                }
                if (pwd==null||pwd.trim()=="") {
                    $("#error").text("密码不能为空!");
                }
                var n = 0;
                //判断是第几次登陆     
                if ($(".user").val() && $(".pass").val()) {
                    if ($(".vister").val()) {
                        //console.log($(".vister").val())
                        type = 1;
                    } else {
                        type = 2;
                    }
                    par = "username=" + username + "&pwd=" + pwd + "&type=" + type + "&method=get.dxWeb.adminLogin"
                    localStorage.setItem("username", username);
                    localStorage.setItem("type", type);
                    var data = getSign(log, par);
                    referIndex(data);
                    n++;
                    window.sessionStorage.setItem("n", n);

                    if (x == 3) {
                        $(".hide").show();
                        x == 3;
                    }

                    //console.log(x)
                } else {
                    return false
                }
                $(".user").val("");
                $(".pass").val("");
            })
        } else {
            if (x == 3) {
                x == 3;
                $(".hide").show();
                $(".btnLogin").click(function () {

                    if (username==null||username.trim()=="") {
                        $("#error").text("用户名不能为空!");
                    }
                    if (pwd==null||pwd.trim()=="") {
                        $("#error").text("密码不能为空!");
                    }
                    //判断是第几次登陆
                    if ($(".user").val() && $(".pass").val()) {
                        if ($(".vister").val()) {
                            type = 1;
                        } else {
                            type = 2;
                        }
                        par = "username=" + username + "&pwd=" + pwd + "&type=" + type + "&method=get.dxWeb.adminLogin"
                        localStorage.setItem("username", username);
                        localStorage.setItem("type", type);
                        var data = getSign(log, par);
                        referIndex(data);
                    } else {
                        return false
                    }
                })
                $(".user").val("");
                $(".pass").val("");
            }
            if (x < 3) {
                $(".hide").hide();
                $(".btnLogin").click(function () {
                    if (username==null||username.trim()=="") {
                        $("#error").text("用户名不能为空!");
                    }
                    if (pwd==null||pwd.trim()=="") {
                        $("#error").text("密码不能为空!");
                    }
                    //判断是第几次登陆         
                    if ($(".user").val() && $(".pass").val()) {
                        if ($(".vister").val()) {
                            //console.log($(".vister").val())
                            type = 1;
                        } else {
                            type = 2;
                        }
                        par = "username=" + username + "&pwd=" + pwd + "&type=" + type + "&method=get.dxWeb.adminLogin"
                        //console.log(par)
                        localStorage.setItem("username", username);
                        localStorage.setItem("type", type);
                        var data = getSign(log, par);
                        referIndex(data);
                        x++;
                        window.sessionStorage.setItem("n", x)
                        if (x == 3) {
                            $(".hide").show();
                        }
                    } else {
                        return false
                    }
                    $(".user").val("");
                    $(".pass").val("");
                })
            }
        }

        //请求验证码
        function phone(url) {

            // $.ajax({
            //     url: url,
            //         type: 'GET',
            //         cache: false,
            //         contentType: false,
            //         processData: false,
            //         dataType:"jsonp",
            //         // contentType : "image/jpeg",
            //         // mimeType:"image/jpeg",
            //         header:{"Access-Control-Allow-Origin":"*"},
            //         dataType:"jsonp",
            //             success:function(data){
            //            //console.log(data)
            //         }
            //     })
            $.ajax({
                url: yzm,
                type: 'GET',
                // dataType: 'binary',
                // contentType: 'image/jpeg',
                headers: {
                    // 'Content-Type': 'image/jpeg',
                    // 'X-Requested-With': 'XMLHttpRequest',
                    'Access-Control-Allow-Origin': '*'
                },
                processData: false,
                crossDomain: true,
                // xhrFields: {
                //     withCredentials: true,
                //     responseType: "blob"
                // },
                // beforeSend: function(xhr) {
                //     // xhr.setRequestHeader('Content-Type', 'image/jpeg');
                //     xhr.setRequestHeader('Access-Control-Allow-Origin', '*');
                // },
                success: function (result) {
                    console.log(result)
                    var blob = result;
                    var img = document.createElement("img");
                    img.onload = function (e) {
                        window.URL.revokeObjectURL(img.src);
                    };
                    img.src = window.URL.createObjectURL(blob);
                    $('#verifyCodeImg').attr('src', img.src);
                    // if (result.Status != 1) {
                    //     myApp.alert(result.Message + '<br/>请检查数据并重试', '失败');
                    //     getCaptcha();
                    //     window.verifyCodeCD = 0;
                    // }
                    // // 成功的时候
                    // else {
                    //     myApp.addNotification({
                    //         title: '成功',
                    //         message: '已发送短信到手机，请查收'
                    //     });
                    // }
                },
                // error: function (XMLHttpRequest, textStatus, errorThrown) {
                //     console.log(XMLHttpRequest, textStatus, errorThrown);
                //     errorMsg = "获取图片验证码失败！<br/>错误信息：" + textStatus + "错误码：" + XMLHttpRequest.status + '<br/>请点击图片验证码位置重试';
                //     myApp.alert(errorMsg, '网络错误');
                // }
            });
        }
    }

    //处理登录成功后密钥存储到缓存
    function referIndex(data) {

        if (data.msg.code == "200") {
            saveInfo();
            localStorage.setItem("appsercet", JSON.stringify({"data": data.userInfo.appsercet}))
            localStorage.setItem("appid", "dxwebf0a37ed1ae96deef")
            window.localStorage.setItem("dxRightsList", JSON.stringify(data.userInfo.dxRightsList.dxRightsCategoryList));
            localStorage.setItem("user_name", data.userInfo.user_name);
            localStorage.setItem("true_name", data.userInfo.true_name);
            // localStorage.setItem("user_phone",data.userInfo.user_phone || "");
            localStorage.setItem("user_photo", data.userInfo.user_photo || "");
            window.location.href = "./index.html";
        } else {
            $("#error").text("用户名或密码错误");
        }
    }
//记住密码功能实现
function checkInCorrect()      //判断用户名和密码是否为空
    {
        if (document.getElementById('username').value == "") {
            alert('请输入用户名！')
            document.getElementById('username').focus();
            return false
        }
        if (document.getElementById('password').value == "") {
            alert('请输入密码！')
            document.getElementById('password').focus();
            return false
        }
        else {
            saveInfo();
            return true;
        }
    }

    saveInfo = function () {
        try {
            var isSave = document.getElementById('remember_password').checked;   //保存按键是否选中
            if (isSave) {
                var username = document.getElementById('username').value;
                var password = document.getElementById('password').value;
                if (username != "" && password != "") {
                    SetCookie(username, password);
                }
            } else {
                SetCookie("", "");
            }
        } catch (e) {

        }
    }

    function SetCookie(username, password) {
        var Then = new Date();
        Then.setTime(Then.getTime() + 1866240000000);
        sessionStorage.setItem("key","username=" + username + "%%" + password + ";expires=" + Then.toGMTString());
    }

    function GetCookie() {
        debugger
        var nmpsd;
        var nm;
        var psd;
        var cookieString = new String(window.sessionStorage.getItem("key"));
        var cookieHeader = "username=";
        var beginPosition = cookieString.indexOf(cookieHeader);
        cookieString = cookieString.substring(beginPosition);
        var ends = cookieString.indexOf(";");
        if (ends != -1) {
            cookieString = cookieString.substring(0, ends);
        }
        if (beginPosition > -1) {
            nmpsd = cookieString.substring(cookieHeader.length);
            if (nmpsd != "") {
                beginPosition = nmpsd.indexOf("%%");
                nm = nmpsd.substring(0, beginPosition);
                psd = nmpsd.substring(beginPosition + 2);
                document.getElementById('username').value = nm;
                document.getElementById('password').value = psd;
                if (nm != "" && psd != "") {
                    // document.forms[0].checkbox.checked = true;
                    document.getElementById('remember_password').checked = true;
                }
            }
        }
    }
</script>
  <script language="javascript" type="text/javascript">
   
</script>