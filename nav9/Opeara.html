<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>东信后台登陆</title>
    <link rel="stylesheet" href="../css/public.css">
    <link rel="stylesheet" href="../css/bootstrap.css">
    <link rel="stylesheet" href="../css/setting.css">
    <link rel="stylesheet" href="../css/index.css">
<link rel="stylesheet" type="text/css" href="http://www.jq22.com/jquery/font-awesome.4.6.0.css">
<link rel="stylesheet" type="text/css" href="../css/buind.css">
<script src="../js/jquery.1.11.1.js"></script>
<script src="../js/bootstrap.min.js"></script>
<link rel="stylesheet" href="../css/paging.css">
<script src="../js/paging.js"></script>
<style>
.isEdit{display: none;}
.isDelete{display: none;}
.item{width: 100%;
    text-align: left;
   /* background-color: #fff; */
    padding: 0;
    height: 30px;
    line-height: 30px;}
</style>
</head>
<body style="background-color:#fbfbfb;width: inherit;box-sizing: border-box;">
    <div class="brand">
        <ul class="breadcrumb" style="background-color:#fff;font-size: 14px;">
            <li><a href="#">设置/</a></li>
            <li><a href="#">管理操作员</a></li>
        </ul>
        <h1>管理操作员</h1>
    </div>
    <div style="width: 1700px;box-sizing: border-box;padding-left:50px;overflow-x: hidden;">
            <div class="col-sm-10 col-sm-pull-1" style="margin-top: 2%;">
                    <div class="flex">
                        <div class="form-group flex">
                            <label for="name" class="control-label col-sm-3" style="text-align: right;line-height: 2.2;font-size: 16px;padding-left: 2%;">角色:</label>
                            <div class="col-sm-8">
                                <select class="form-control chOperator" style="width:400px">
                                    <option checked value="0">--请选择--</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-3 flex " style="margin-right:40%;text-align: right;">
                            <div class="position" style="width: 100%;position: absolute;left: 80%">
                                <input type="text" class="form-control opName" placeholder="请输入员工姓名" />
                                <span style="font-family: iconfont;position: absolute;right: 1%;top:0;font-size: 24px;" class="searvh1">&#xe615;</span>
                            </div> 
                        </div>   
                       
                    </div>
                        <div class="form-group flex" style="padding-bottom: 2%;">
                            <div class="col-sm-2" style="text-align: center;">
                                <button class="btn btn-primary add saveBtn addto" style="display: none;">添加操作员</button>
                            </div>
                            <div class="col-sm-1 " style="text-align: center;" >
                                <button class="btn qy btngroup" style="background:#fff;height:40px;width:100px;display: none;">启用</button>
                            </div>
                            <div class="col-sm-1 " style="text-align: center;">
                                <button class="btn jy btngroup" style="background:#fff;height:40px;width:100px;display: none;">禁用</button>
                            </div>
                            <div class="col-sm-1 " style="text-align: center;">
                                <button class="btn delete btngroup" style="background:#fff;height:40px;width:100px;display: none;">删除</button>
                            </div>
                        </div>
                        <table class="table" style="width: 100%;overflow: hidden;">
                            <thead>
                                <tr style="text-align:center;border-bottom: 1px solid #d8d8d8;">
                                    <th class="position loginId">
                                        <div class="radio radio-info radio-inline">
                                            <input type="radio" id="inlineRadio1" value="option1" name="radioInline" checked="">
                                            <label for="inlineRadio1"> 登录ID </label>
                                        </div>
                                        </th>
                                    <th>角色</th>
                                    <th>姓名</th>
                                    <th>手机</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody class="operater">
                               
                              
                            </tbody>
                        </table>
                        
                        <div class="paging flex justify"  >
                            <div style="color:#929292;font-size: 14px;padding-left: 20px;">共<span class="total"></span>条数据&nbsp;第<span class="current">1</span>/<span
                                    class="pagenum">80</span>页</div>
                            <div style="width:60%;">
                                <div class="box" id="box" style="width:auto;justify-content: flex-end;"></div>
                            </div>
                        </div>
                   </div>
                   <div class="nv91-mask" >
                        <div class="nv91" style="padding:5% 0">
                            <form action="" class="form-horizontal" role="form" style="text-align:center;">
                                <div class="form-group  flex" style="justify-content: center">
                                    <label for="" class="control-label  col-sm-3 star" style="text-align: right;line-height: 2;">操作人员用户名:</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control user1" placeholder="" required/>
                                    </div>
                                </div>
                                <div class="form-group  flex" style="justify-content: center">
                                    <label for="" class="control-label col-sm-3 star" style="text-align: right;line-height: 2;">操作人员密码:</label>
                                    <div class="col-sm-9">
                                        <input type="password" class="form-control user2" placeholder="" required/>
                                    </div>
                                </div>
                                <div class="form-group  flex" style="justify-content: center">
                                    <label for="" class="control-label col-sm-3 " style="text-align: right;line-height: 2;">所属角色:</label>
                                    <div class="col-sm-9">
                                        <select  class="form-control manRole1" required>
                                            <option selected="selected" value="0">--请选择-- </option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group  flex" style="justify-content: center">
                                    <label for="" class="control-label  col-sm-3" style="text-align: right;line-height: 2;">姓名:</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control user3" placeholder="" required/>
                                    </div>
                                </div>
                                <div class="form-group  flex" style="justify-content: center">
                                    <label for="name" class="control-label col-sm-3" style="text-align: right;line-height: 2;">电话:</label>
                                    <div class="col-sm-9">
                                        <input type="number" class="form-control user4" placeholder="" required />
                                    </div>
                                </div>
                                <div class="form-group flex">
                                    <label for="name" class="control-label col-sm-3" style="text-align: right;line-height: 1.5;">角色状态:</label>
                                    <div class="radio radio-info radio-inline ">
                                        <input type="radio" id="o7" value="1" name="o7" checked="" class="status">
                                        <label for="o7"> 启用 </label>
                                    </div>
                                    <div class="radio radio-info radio-inline">
                                        <input type="radio" id="o8" value="2" name="o7" checked="" class="status">
                                        <label for="o8"> 禁用 </label>
                                    </div>
                                </div>
                                <div class="col-sm-9" style="margin-left: 12.5%;">
                                    <p >用户可以在此角色权限的基础上附加其他权限</p>
                                </div>
                                <div class="form-group flex" >
                                    <label for="name" class="control-label col-sm-3" style="text-align: right;line-height: 2;">可用权限:</label>
                                    <ul class="list-group col-sm-9 qx">
                            
                                    </ul>
                                </div>
                                <div class="form-group flex butto" style="border-top:1px solid #EBEBEB;margin-top: 100px;justify-content: flex-end;box-sizing: border-box;">
                                    <div class="col-sm-2" style="margin-top: 1%;margin-right:-7%;">
                                        <button class="btn btn-primary roleSure">确定</button>
                                    </div>
                                    <div class="col-sm-2" style="margin-top: 1%;margin-right:2%;">
                                        <button class="btn  roleRefuse">取消</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                   <footer class="footer">
                        <p>Copyright 2017 中国东信云通信平台 All Right Reserved 中国—东盟信息港股份有限公司北京分公司
                         </p>
                        <p>增值电信业务经营许可证：B2-20180289 涉密信息系统集成许可证：JC301700083</p>
                         
                         <p>桂ICP备16005301号-7 桂公网安备45010802000099号</p>
                    </footer>
    </div>
  
</body>
</html>
<script src="../js/MD5.js"></script>
<script src="../js/sign.js"></script>
<script src="../js/api.js"></script>
<script type="text/javascript">
    function changeState(el) {
        if (el.readOnly) el.checked=el.readOnly=false;
        else if (!el.checked) el.readOnly=el.indeterminate=true;
    }
    window.onload = function(){
        //页面初次渲染加载数据
        
        var data = window.localStorage.getItem("dxRightsList");  
        data = JSON.parse(data);
       
        //console.log(data);
        //页面初次加载渲染页面
        var url,par;
        // Datetime();
        var appsercet = window.localStorage.getItem("appsercet");
        appsercet = JSON.parse(appsercet);
        var newAppsercet = appsercet.data;
        //判断是否有添加管理员操作权限
       
        // return
        var arr = [];
        $.each(data,function(i,item){
            //console.log(item)
            if(item.name == "设置"){
                arr.push(item)
            }
        })
        //console.log(arr[0]);
       
        $.each(arr[0].dxRightsList,function(i,item){
            //console.log(arr[0].dxRightsList)
            if(item.method === "get.dxWeb.operation"){
                url = src+"/"+item.link_path;
                par = "appsercet="+newAppsercet+"&method="+item.method;
                //console.log(url,par);
                logsgin(url,par);
                pagenow(url,"get.dxWeb.operation");
                 //请求全部管理员
                par = "appsercet="+newAppsercet+"&method=get.dxWeb.managementRolesList"
                
                logsgin(url,par);
                 //用户名查询
                    var role,sensoperation;
                    $(".chOperator").change(function(){
                        
                        var val = $(".chOperator option:checked").val();
                        var htm = $(".chOperator option:checked").html();
                        role = htm;
                       
                        par = "appsercet="+newAppsercet+"&method=get.dxWeb.operation&roleId="+val;
                        logsgin(url,par);

                        if(val == 0){
                            par = "appsercet="+newAppsercet+"&method=get.dxWeb.operation";
                            logsgin(url,par);
                        }
                    })
                $(".opName").blur(function(){
                    sensoperation = $(this).val()
                    //console.log(sensoperation)
                })
                $(".searvh1").click(function(){
                    //console.log(sensoperation)
                    par = "appsercet="+newAppsercet+"&method=get.dxWeb.operation&trueName="+sensoperation;
                    logsgin(url,par);  
                })
                //判断该角色是否有权限操作
                if(item.dxRightsTwoList.length == 0){
                    return
                }
                else{
                   
                    $.each(item.dxRightsTwoList,function(i,obj){
                       //判断该用户是否有添加管理员权限
                        if(obj.method === "get.dxWeb.addOperation"){
                            
                            $(".add").show();
                            $(".add").click(function(){                               
                                add();                             
                                url = src+"/adminInterface.dx";
                                par = "appsercet="+newAppsercet+"&method=get.dxWeb.leftMenuAll";
                                logsgin(url,par);
                                var status,rightsIds,roleName    
                                var user1,user2,user3,user4,roleId
                                $(".manRole1").change(function(){
                                    if($(".manRole1 option:checked")){
                                        var val = $(".manRole1 option:checked").val()
                                        if(val == 0){
                                            return
                                        }
                                        roleId = val
                                    }
                                })
                                $(".user1").blur(function(){
                                    user1 = $(this).val()
                                }) 
                                $(".user2").blur(function(){
                                    user2 = $(this).val()
                                })               
                                $(".user3").blur(function(){
                                    user3 = $(this).val()
                                }) 
                                $(".user4").blur(function(){
                                    user4 = $(this).val()
                                }) 
                            $(".roleSure").click(function(){
                               
                                var inputs = document.querySelectorAll(".item3 input");//获取所有的input标签对象
                                var radio = document.querySelectorAll(".status ");
                                var checkboxArray = [];//初始化空数组，用来存放checkbox对象。
                                for (var i = 0; i < inputs.length; i++) {
                                    var obj = inputs[i];
                                    if (obj.type == 'checkbox' && obj.className=='item2') {
                                        checkboxArray.push(obj);
                                    }
                                }
                                var rightsIds = new Array();
                                for (var i = 0; i < radio.length; i++) {
                                    if (radio[0].checked){
                                        status = 1;
                                    }else{
                                        status = 2;
                                    }
                                    
                                }
                                
                                for (var i = 0; i < checkboxArray.length; i++) {
                                    if (checkboxArray[i].checked)
                                    rightsIds.push(checkboxArray[i].value);
                                }
                                console.log(rightsIds)
                                url = src+"/adminInterface.dx";
                                                 
                                par = "appsercet="+newAppsercet+"&method=get.dxWeb.addOperation&status="+status+"&roleIds="+rightsIds+"&username="+user1+"&pwd="+user2+"&roleId="+roleId+"&modilePhone="+user4+"&trueName="+user3;                         
                                logsgin(url,par);
                                   
                                                         
                            })
                            $(".roleRefuse").click(function(){
                                $(".nv91-mask").fadeOut();
                                $(".nv91").hide();
                            })                             
                            })
                           
                            }
                        //判断该用户是否有启用或禁用权限
                     if(obj.method === "get.dxWeb.isAdminEnableOrProhibit"){
                            $(".qy").show();
                            $(".jy").show();                         
                            $(".qy").click(function(){
                                open("get.dxWeb.isAdminEnableOrProhibit", 1)                    
                            })
                            $(".jy").click(function(){
                                open("get.dxWeb.isAdminEnableOrProhibit",2)
                            })
                        }
                        //判断该用户是否有删除权限 
                       if(obj.method === "get.dxWeb.deleteAdmin"){
                     
                                $(".delete").show();
                                $(".isDelete").show();               
                                $(".delete").click(function(){
                                    var value
                                    
                                    deleteM("get.dxWeb.deleteAdmin")
                                   
                                })
                                $(".isDelete").click(function(){
                                    deleteM("get.dxWeb.deleteAdmin")
                                })
                            }
                            //判断是否有查看权限
                         if(obj.method === "get.dxWeb.adminDetails"){
                                $(".isEdit").show()
                                $(".botto").hide();
                                
                                edit("get.dxWeb.adminDetails","get.dxWeb.updateOperation")
                               
                            }  
                            //判断是否有编辑权限
                           if(obj.method === "get.dxWeb.updateOperation"){
                                    $(".botto").show()
                                   
                                }   
                                          
                                          
                    })
                    
                }
            }
        })
       
       
       //底部页码
       getPage() 
    }
   
</script>

